{"version":3,"file":"sld-editor.js","sourceRoot":"","sources":["../sld-editor.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,EAAkB,MAAM,KAAK,CAAC;AAC1E,gEAAgE;AAChE,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1E,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,SAAS,EAAO,GAAG,EAAE,MAAM,uBAAuB,CAAC;AAE5D,OAAO,EAAQ,YAAY,EAAE,MAAM,wBAAwB,CAAC;AAO5D,OAAO,sBAAsB,CAAC;AAC9B,OAAO,oBAAoB,CAAC;AAC5B,OAAO,qCAAqC,CAAC;AAC7C,OAAO,wBAAwB,CAAC;AAChC,OAAO,yBAAyB,CAAC;AAEjC,OAAO,EAAE,YAAY,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC3D,OAAO,EACL,UAAU,EACV,UAAU,EACV,gBAAgB,EAChB,QAAQ,EACR,OAAO,EACP,YAAY,EACZ,UAAU,EACV,YAAY,EACZ,OAAO,EACP,mBAAmB,EACnB,iBAAiB,EACjB,UAAU,GACX,MAAM,YAAY,CAAC;AACpB,OAAO,EACL,UAAU,EACV,qBAAqB,EACrB,WAAW,EACX,QAAQ,EACR,QAAQ,EACR,eAAe,EACf,aAAa,EACb,kBAAkB,EAClB,cAAc,EACd,gBAAgB,EAChB,cAAc,EACd,oBAAoB,EACpB,kBAAkB,EAClB,uBAAuB,EACvB,qBAAqB,EACrB,qBAAqB,EAErB,WAAW,EACX,QAAQ,EACR,UAAU,EACV,cAAc,EACd,aAAa,EACb,aAAa,EACb,cAAc,EACd,KAAK,EACL,KAAK,EACL,UAAU,EACV,IAAI,EACJ,OAAO,EACP,UAAU,GACX,MAAM,WAAW,CAAC;AAEnB,MAAM,UAAU,GAAsC;IACpD,mBAAmB,EAAE,CAAC,KAAK,CAAC;IAC5B,GAAG,EAAE,CAAC,cAAc,CAAC;IACrB,YAAY,EAAE,CAAC,YAAY,CAAC;IAC5B,gBAAgB,EAAE,CAAC,KAAK,EAAE,cAAc,EAAE,YAAY,CAAC;CACxD,CAAC;AAIF,SAAS,kBAAkB,CAAC,OAAgB;IAC1C,OAAO,IAAI,WAAW,CAAmB,0BAA0B,EAAE;QACnE,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;QACd,MAAM,EAAE,EAAE,OAAO,EAAE;KACpB,CAAC,CAAC;AACL,CAAC;AAMD,SAAS,QAAQ,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAO,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAO;IAC9D,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AAC1E,CAAC;AAED,SAAS,QAAQ,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAO,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAO;IAC9D,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE;QAAE,OAAO,KAAK,CAAC;IACjD,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE;QAAE,OAAO,KAAK,CAAC;IACjD,OAAO,IAAI,CAAC;AACd,CAAC;AAED,SAAS,YAAY,CACnB,OAAgB,EAChB,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU;IAEV,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EACX,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;IACxB,OAAO,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;AAClD,CAAC;AAED,SAAS,YAAY,CACnB,OAAgB,EAChB,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU;IAEV,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EACX,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;IACxB,OAAO,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;AAClD,CAAC;AAED,SAAS,QAAQ,CAAC,OAAgB;;IAChC,MAAM,EAAE,GAAG,OAAO,CAAC,SAAS,CAAC;IAC7B,IACE,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC;QACrB,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC;QACtB,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;QACnB,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,EAClD;QACA,OAAO,CAAC,MAAM,EAAE,CAAC;QACjB,OAAO;KACR;IACD,IAAI,EAAE,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC;QACnD,MAAA,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC,0CAAE,MAAM,EAAE,CAAC;IAC1C,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QAC7C,IAAI,KAAK,CAAC,QAAQ,KAAK,CAAC;YAAE,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACrD,IAAI,KAAK,CAAC,QAAQ,KAAK,CAAC;YAAE,QAAQ,CAAC,KAAgB,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,OAAO,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS;IAC9C,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAClD,CAAC;AAED,SAAS,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAQ;IAC7D,OAAO,CACL,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,OAAO,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAC5C,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,OAAO,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAC7C,CAAC;AACJ,CAAC;AAED,SAAS,YAAY,CAAC,EAAS,EAAE,EAAS;IACxC,MAAM,MAAM,GAAG,EAAa,CAAC;IAC7B,MAAM,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACtC,IAAI,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IACxC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IAC7B,CAAC,GAAG,CAAC,CAAC,KAAK,EAAW,CAAC;IACvB,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IACxC,OAAO,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,EAAE;QAC3B,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACf,CAAC,GAAG,CAAC,CAAC,KAAK,EAAW,CAAC;QACvB,CAAC,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC;KACjB;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,SAAS,QAAQ,CAAC,CAAC,EAAE,EAAE,EAAE,CAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAQ;IAChD,OAAO,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;AAC/C,CAAC;AAED,SAAS,kBAAkB,CAAC,CAAQ,EAAE,EAAS,EAAE,EAAS;IACxD,IAAI,KAAK,GAAG,EAAE,CAAC;IACf,MAAM,MAAM,GAAG,YAAY,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IAEpC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;QACzB,IAAI,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;YAAE,KAAK,GAAG,SAAS,CAAC;IACrE,CAAC,CAAC,CAAC;IAEH,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,gBAAgB,CAAC,EAAS,EAAE,EAAS,EAAE,GAAU,EAAE,GAAU;IACpE,IAAI,MAAM,CAAC,EAAE,EAAE,GAAG,EAAE,GAAG,CAAC;QAAE,OAAO,EAAE,CAAC;IACpC,IAAI,MAAM,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC;QAAE,OAAO,GAAG,CAAC;IACpC,IAAI,MAAM,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC;QAAE,OAAO,GAAG,CAAC;IACpC,OAAO,kBAAkB,CAAC,EAAE,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;AAC1C,CAAC;AAED,SAAS,SAAS,CAAC,IAAa;IAC9B,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;IACxB,OAAO,CAAC,GAAG,CAAC,EAAE;QACZ,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACvB,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC7B,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAE7B,IACE,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC;YACtB,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC;YACtB,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC;YAEtB,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACpB,CAAC,IAAI,CAAC,CAAC;KACR;AACH,CAAC;AAED,SAAS,KAAK,CAAC,OAAgB;IAC7B,OAAO,OAAO,CAAC,OAAO,KAAK,KAAK,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACzD,CAAC;AAED,SAAS,cAAc,CAAC,CAAa;IACnC,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC;QAAE,CAAC,CAAC,cAAc,EAAE,CAAC;AACzC,CAAC;AAED,SAAS,IAAI,CAAC,OAAgB,EAAE,GAAW;IACzC,MAAM,KAAK,GAAG,OAAO,CAAC,SAAS,CAAC,IAAI,CAAY,CAAC;IACjD,MAAM,SAAS,GAAG,IAAI,GAAG,CACvB,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,CAAC,CAC/D,CAAC;IACF,MAAM,MAAM,GAAG,IAAI,GAAG,CACpB,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CACzD,CAAC;IACF,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;QAC3B,MAAM,KAAK,GAAG,OAAO,CAAC,aAAa,CAAC,aAAa,CAC/C,8BAA8B,QAAQ,CAAC,YAAY,CACjD,kBAAkB,CACnB,IAAI,CACN,CAAC;QACF,IAAI,KAAK;YAAE,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC,CAAC,CAAC;IACH,MAAM,aAAa,GAAG,IAAI,GAAG,EAAW,CAAC;IACzC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QACrB,MAAM,eAAe,GAAG,KAAK,CAAC,IAAI,CAChC,OAAO,CAAC,aAAa,CAAC,gBAAgB,CACpC,sBAAsB,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CACzD,CACF,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC7C,IACE,eAAe;YACf,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAE,CAAC;gBAC9B,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,OAAO,CAAC;YAE7C,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC7B,CAAC,CAAC,CAAC;IACH,aAAa,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;;QAC5B,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,OAAO,EAAE;YAC9C,IAAI,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAE,CAAC;gBACjC,MAAA,MAAA,KAAK;qBACF,aAAa,CACZ,8BAA8B,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CACjE,0CACC,OAAO,CAAC,KAAK,CAAC,0CACd,MAAM,EAAE,CAAC;;gBAEb,MAAA,KAAK;qBACF,aAAa,CACZ,8BAA8B,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CACjE,0CACC,MAAM,EAAE,CAAC;SAChB;QACD,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;;YAC3B,IACE,QAAQ,CAAC,YAAY,CAAC,kBAAkB,CAAC;gBACzC,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC;gBAE9B,MAAA,KAAK;qBACF,aAAa,CAAC,YAAY,QAAQ,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,0CACpE,MAAM,EAAE,CAAC;QACjB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IACH,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,CAAC,CAAC,OAAO,CAClE,QAAQ,CAAC,EAAE;QACT,MAAM,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACvD,IAAI,CAAC,OAAO;YAAE,OAAO;QACrB,MAAM,OAAO,GAAG,IAAI,EAAE,CAAC;QACvB,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,kBAAkB,OAAO,GAAG,CAAC,CAAC,CAAC,OAAO,CACtE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,EAAE,GAAG,GAAG,OAAO,EAAE,OAAO,CAAC,CAC/D,CAAC;QACF,QAAQ,CAAC,cAAc,CAAC,KAAK,EAAE,GAAG,GAAG,OAAO,EAAE,OAAO,CAAC,CAAC;IACzD,CAAC,CACF,CAAC;IACF,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,gBAAgB,CAAC,OAAgB;IACxC,MAAM,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC;IAC7D,IAAI,MAAM,GAAsC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;IAC7E,MAAM,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;IAC1C,IAAI,IAAI,EAAE;QACR,IAAI,MAAM;YAAE,MAAM,GAAG,IAAI,CAAA,GAAG,IAAI,YAAY,MAAM,EAAE,CAAC;;YAChD,MAAM,GAAG,IAAI,CAAC;KACpB;IACD,IAAI,aAAa,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC;IAC3C,IAAI,OAAO,CAAC,OAAO,KAAK,kBAAkB,EAAE;QAC1C,MAAM,QAAQ,GAAG,OAAO,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,CAAC,MAAM,CAAC;QACvE,MAAM,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACrC,IAAI,QAAQ,KAAK,CAAC,EAAE;YAClB,aAAa,GAAG,OAAO,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAAC;SACjD;aAAM,IAAI,QAAQ,KAAK,CAAC,EAAE;YACzB,aAAa,GAAG,OAAO,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;SACvD;aAAM;YACL,aAAa,GAAG,OAAO,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;SACvD;KACF;SAAM,IAAI,OAAO,CAAC,OAAO,KAAK,oBAAoB;QACjD,aAAa,GAAG,OAAO,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAAC;SAC7C,IAAI,OAAO,CAAC,OAAO,KAAK,qBAAqB;QAChD,aAAa,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC;SACpC,IAAI,OAAO,CAAC,OAAO,KAAK,KAAK,IAAI,QAAQ,CAAC,OAAO,CAAC;QACrD,aAAa,GAAG,IAAI,CAAA,qDAAqD,CAAC;SACvE,IAAI,OAAO,CAAC,OAAO,KAAK,KAAK;QAAE,aAAa,GAAG,UAAU,CAAC;SAC1D,IAAI,OAAO,CAAC,OAAO,KAAK,cAAc;QACzC,aAAa,GAAG,mBAAmB,CAAC;SACjC,IAAI,OAAO,CAAC,OAAO,KAAK,MAAM,EAAE;QACnC,aAAa,GAAG,IAAI,CAAA,2CAA2C,CAAC;QAChE,MAAM,GAAG,OAAO,CAAC,WAAW,CAAC;KAC9B;IACD,OAAO,IAAI,CAAA,2BAA2B,MAAM;YAClC,IAAI;MACV,MAAM;QACN,CAAC,CAAC,IAAI,CAAA;;;;YAIA,MAAM;gBACF;QACV,CAAC,CAAC,OAAO;MACT,aAAa;mBACA,CAAC;AACpB,CAAC;AAIM,IAAM,SAAS,GAAf,MAAM,SAAU,SAAQ,UAAU;IAAlC;;QAQL,cAAS,GAAG,CAAC,CAAC,CAAC;QAGf,aAAQ,GAAG,EAAE,CAAC;QAGd,QAAG,GAAG,MAAM,CAAC;QAYb,kBAAa,GAAU,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QA0C9B,WAAM,GAAG,CAAC,CAAC;QAGX,WAAM,GAAG,CAAC,CAAC;QAGX,YAAO,GAAG,CAAC,CAAC;QAGZ,YAAO,GAAG,CAAC,CAAC;QAGZ,aAAQ,GAAG,CAAC,CAAC;QAGb,aAAQ,GAAG,CAAC,CAAC;QAKb,mBAAc,GAAqB,SAAS,EAAE,CAAC;QAgJ/C,kBAAa,GAAG,CAAC,EAAE,GAAG,EAAiB,EAAE,EAAE;YACzC,IAAI,GAAG,KAAK,QAAQ;gBAAE,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC;QAC9C,CAAC,CAAC;QAEF,gBAAW,GAAG,CAAC,CAAa,EAAE,EAAE;YAC9B,IACE,IAAI,CAAC,IAAI;gBACT,CAAC,CAAC;qBACC,YAAY,EAAE;qBACd,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,IAAI,GAAG,IAAI,GAAG,CAAC,EAAE,KAAK,kBAAkB,CAAC,EAC5D;gBACA,CAAC,CAAC,wBAAwB,EAAE,CAAC;gBAC7B,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC;aACvB;QACH,CAAC,CAAC;IAy6EJ,CAAC;IArnFC,IAAI,IAAI;QACN,OAAO,CAAC,CACN,IAAI,CAAC,OAAO;YACZ,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,YAAY;YACjB,IAAI,CAAC,UAAU,CAChB,CAAC;IACJ,CAAC;IAwCD,mBAAmB,CAAC,CAAa;;QAC/B,MAAM,cAAc,GAAG,MAAA,IAAI,CAAC,cAAc,0CAAE,KAAK,CAAC;QAClD,IAAI,cAAc,EAAE;YAClB,cAAc,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,OAAO,IAAI,CAAC;YAC5C,cAAc,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,CAAC,CAAC,OAAO,GAAG,EAAE,IAAI,CAAC;SACnD;IACH,CAAC;IAED,QAAQ,CAAC,OAAgB,EAAE,CAAa;QACtC,IAAI,IAAI,CAAC,IAAI;YAAE,IAAI,CAAC,IAAI,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;QACxE,CAAC,CAAC,cAAc,EAAE,CAAC;IACrB,CAAC;IAED,cAAc,CAAC,OAAe,EAAE,OAAe;QAC7C,MAAM,CAAC,GAAG,IAAI,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QACzC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,EAAG,CAAC,OAAO,EAAE,CAAC,CAAC;QACvE,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,CAAU,CAAC;IAC1D,CAAC;IAED,UAAU,CAAC,OAAgB,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;QACrE,IAAI,OAAO,CAAC,OAAO,KAAK,YAAY;YAAE,OAAO,IAAI,CAAC;QAElD,MAAM,kBAAkB,GAAG,KAAK,CAAC,IAAI,CACnC,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,GAAG,OAAO,CAAC,OAAO,oBAAoB,CAAC,CACzE,CAAC,IAAI,CACJ,OAAO,CAAC,EAAE,CACR,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,OAAO;YAC5C,YAAY,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YACjC,CAAC,QAAQ,CAAC,OAAO,CAAC,CACrB,CAAC;QACF,IAAI,kBAAkB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;YAC5C,OAAO,KAAK,CAAC;SACd;QAED,MAAM,gBAAgB,GACpB,OAAO,CAAC,OAAO,KAAK,cAAc;YAClC,OAAO,CAAC,OAAO,KAAK,kBAAkB;YACpC,CAAC,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YAC3C,CAAC,CAAC,KAAK,CAAC,IAAI,CACR,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAC9B,UAAU,CAAC,OAAO,CAAC,OAAO,CAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CACvC,CACF,CAAC,IAAI,CACJ,MAAM,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAChE,CAAC;QACR,IAAI,gBAAgB;YAAE,OAAO,IAAI,CAAC;QAClC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,WAAW,CAAC,OAAgB,EAAE,CAAS,EAAE,CAAS;QAChD,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EACX,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,GAClB,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QAExB,IACE,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YACrC,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC;YAE1C,OAAO,KAAK,CAAC;QAEf,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;;YAC1D,IAAI,CAAC,CAAA,MAAA,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,0CAAE,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;gBAAE,OAAO,KAAK,CAAC;YACxE,MAAM,EACJ,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EACb,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,GACd,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;YAEtB,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QACH,IAAI,SAAS;YAAE,OAAO,KAAK,CAAC;QAE5B,OAAO,IAAI,CAAC;IACd,CAAC;IAED,aAAa,CAAC,OAAgB,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;QACxE,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YAAE,OAAO,KAAK,CAAC;QAExD,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;;YAC1D,IAAI,CAAC,CAAA,MAAA,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,0CAAE,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;gBAAE,OAAO,KAAK,CAAC;YACxE,MAAM,EACJ,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EACb,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,GACd,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;YAEtB,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QACH,IAAI,SAAS;YAAE,OAAO,KAAK,CAAC;QAE5B,OAAO,IAAI,CAAC;IACd,CAAC;IAED,qBAAqB,CAAC,OAAgB;QACpC,IAAI,EACF,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACd,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACxB,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;QAC9C,IACE,IAAI,CAAC,OAAO;YACZ,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,EACtD;YACA,MAAM,EACJ,GAAG,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,GACxB,GAAG,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC7B,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,OAAO,GAAG,OAAO,CAAC;YACrC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,OAAO,GAAG,OAAO,CAAC;SACtC;QACD,IAAI,IAAI,CAAC,YAAY,KAAK,OAAO,EAAE;YACjC,CAAC,GAAG,IAAI,CAAC,OAAO,GAAG,GAAG,GAAG,OAAO,CAAC;YACjC,CAAC,GAAG,IAAI,CAAC,OAAO,GAAG,GAAG,GAAG,OAAO,CAAC;SAClC;QACD,IAAI,IAAI,CAAC,UAAU,KAAK,OAAO,EAAE;YAC/B,MAAM,EACJ,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,EACjB,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,GAClB,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;YACxB,IAAI,IAAI,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,EAAE;gBAC5B,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;gBACnD,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;aACpD;SACF;QACD,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAChB,CAAC;IAED,gBAAgB,CAAC,OAAgB;QAC/B,IAAI,EACF,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACxB,IACE,IAAI,CAAC,OAAO;YACZ,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,EACtD;YACA,MAAM,EACJ,GAAG,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,GACxB,GAAG,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC7B,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;YAC9C,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,OAAO,GAAG,OAAO,CAAC;YACrC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,OAAO,GAAG,OAAO,CAAC;SACtC;QACD,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAChB,CAAC;IAkBD,iBAAiB;QACf,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACvD,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACzD,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;IAC7D,CAAC;IAED,oBAAoB;QAClB,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAC7B,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAC1D,MAAM,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACtD,MAAM,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;IAChE,CAAC;IAED,OAAO;QACL,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAY,CAAC;QAChD,QAAQ,CAAC,GAAG,CAAC,CAAC;QACd,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,EAAE;YACxC,IAAI,EAAE,iBAAiB;SACxB,CAAC,CAAC;QAEH,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QACtC,CAAC,CAAC,QAAQ,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QAC3D,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QACnC,CAAC,CAAC,OAAO,CAAC,WAAW,GAAG,CAAC,iBAAiB,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC1E,CAAC,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QACzB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,KAAK,EAAE,CAAC;QACV,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QAC7B,UAAU,CAAC,GAAG,EAAE;YACd,GAAG,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;QAC9B,CAAC,EAAE,IAAI,CAAC,CAAC;IACX,CAAC;IAED,mBAAmB,CAAC,SAAmB;QACrC,IAAI,CAAC,SAAS;YAAE,OAAO,SAAS,CAAC;QACjC,MAAM,WAAW,GAAG,SAAS,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;QACnE,MAAM,cAAc,GAAG,SAAS,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;QAC5E,MAAM,QAAQ,GAAG,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM,CAAE,CAAC,CAAC;QACrE,IAAI,WAAW,IAAI,cAAc;YAAE,OAAO,SAAS,CAAC;QACpD,IAAI,QAAQ,IAAI,CAAC,WAAW,IAAI,cAAc,CAAC;YAAE,OAAO,SAAS,CAAC;QAClE,IAAI,QAAQ;YAAE,OAAO,IAAI,CAAC;QAC1B,IAAI,WAAW;YAAE,OAAO,IAAI,CAAC;QAC7B,IAAI,cAAc;YAAE,OAAO,IAAI,CAAC;QAEhC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,EACJ,GAAG,EACH,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;QAC1B,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,GAAG;YAAE,OAAO,IAAI,CAAC;QAC5C,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,GAAG,GAAG;YAAE,OAAO,IAAI,CAAC;QAC3C,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,GAAG,GAAG;YAAE,OAAO,IAAI,CAAC;QAC3C,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,GAAG;YAAE,OAAO,IAAI,CAAC;QAC5C,OAAO,IAAI,CAAC;IACd,CAAC;IAED,cAAc,CAAC,SAAkB,EAAE,IAA+B;QAChE,MAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAC1C,MAAM,GAAG,GAAG,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACrC,IAAI,CAAC,GAAG,EAAE;YACR,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;YACvB,OAAO;SACR;QACD,MAAM,KAAK,GAAW,EAAE,CAAC;QACzB,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAC9B,4CAA4C,CAC7C,CAAC;QACF,IAAI,QAAQ,GAAG,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,YAAY,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,CAAC,QAAQ,EAAE;YACb,QAAQ,GAAG,WAAW,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;YACxC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CACjC,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,YAAY,EACrC,kBAAkB,CACnB,CAAC;YACF,QAAQ,CAAC,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAC1C,QAAQ,CAAC,YAAY,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;YAC5C,KAAK,CAAC,IAAI,CAAC;gBACT,MAAM,EAAE,GAAG;gBACX,IAAI,EAAE,QAAQ;gBACd,SAAS,EAAE,YAAY,CAAC,GAAG,EAAE,kBAAkB,CAAC;aACjD,CAAC,CAAC;SACJ;QACD,MAAM,OAAO,GAAG,YAAY,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,UAAU,CAAC;QAC3D,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CACvC,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,YAAY,EACrC,OAAO,CACR,CAAC;QACF,QAAQ,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QACpC,QAAQ,CAAC,YAAY,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;QAC/C,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,YAAY,CAAE,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC9D,IAAI,KAAK;YAAE,QAAQ,CAAC,YAAY,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;QAC1D,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,cAAc,CAAE,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACjE,IAAI,MAAM;YAAE,QAAQ,CAAC,YAAY,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;QAC9D,MAAM,KAAK,GAAG,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACvC,IAAI,KAAK;YAAE,QAAQ,CAAC,YAAY,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;QACnD,QAAQ,CAAC,YAAY,CAAC,kBAAkB,EAAE,QAAQ,CAAC,CAAC;QACpD,KAAK,CAAC,IAAI,CAAC;YACT,MAAM,EAAE,SAAS;YACjB,IAAI,EAAE,QAAQ;YACd,SAAS,EAAE,YAAY,CAAC,SAAS,EAAE,OAAO,CAAC;SAC5C,CAAC,CAAC;QACH,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;IAC1C,CAAC;IAED,WAAW,CAAC,OAAgB;QAC1B,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QAC3C,MAAM,KAAK,GAAW;YACpB;gBACE,OAAO;gBACP,UAAU,EAAE;oBACV,CAAC,GAAG,IAAI,CAAC,GAAG,OAAO,CAAC,EAAE;wBACpB,YAAY,EAAE,KAAK;wBACnB,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM;qBAC5B;iBACF;aACF;SACF,CAAC;QACF,IAAI,OAAO,CAAC,OAAO,KAAK,kBAAkB,EAAE;YAC1C,MAAM,OAAO,GAAG,OAAO,CAAC,aAAa,CAAC,oBAAoB,CAAE,CAAC;YAC7D,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAClE,KAAK,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC,CACxC,CAAC;YACF,IAAI,IAAI,KAAK,UAAU,EAAE;gBACvB,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,CAChE,KAAK,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC,CAClC,CAAC;aACH;SACF;QACD,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;IAC1C,CAAC;IAED,SAAS,CAAC,OAAgB;QACxB,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACxB,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CACnC,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,YAAY,EACrC,MAAM,CACP,CAAC;QACF,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,GAAG,KAAK,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC3D,IAAI,CAAC,cAAc,CACjB,KAAK,EACL,GAAG,IAAI,CAAC,GAAG,KAAK,EAChB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE,CACnC,CAAC;QACF,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;YACX,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,OAAO;YACf,SAAS,EAAE,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC;SACzC,CAAC,CACH,CAAC;IACJ,CAAC;IAED,2BAA2B,CAAC,OAAgB;QAC1C,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;QAEvD,MAAM,KAAK,GAAe;YACxB;gBACE,OAAO,EAAE,IAAI,CAAA;sBACC,UAAU,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO;;yBAE9B;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;aAC/D;SACF,CAAC;QAEF,IAAI,UAAU;YACZ,KAAK,CAAC,OAAO,CACX;gBACE,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,CAAC;gBACrE,OAAO,EAAE,IAAI,CAAA;;;2BAGI;aAClB,EACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;2BAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;aAClE,CACF,CAAC;;YAEF,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,GAAG,EAAE;oBACZ,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,CACnC,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,YAAY,EACrC,YAAY,CACb,CAAC;oBACF,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;oBACjC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;oBACjC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;oBACrD,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;wBACX,MAAM,EAAE,OAAO;wBACf,IAAI;wBACJ,SAAS,EAAE,YAAY,CAAC,OAAO,EAAE,YAAY,CAAC;qBAC/C,CAAC,CACH,CAAC;gBACJ,CAAC;gBACD,OAAO,EAAE,IAAI,CAAA;;;yBAGI;aAClB,CAAC,CAAC;QAEL,MAAM,aAAa,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC;QAE3E,IAAI,aAAa,CAAC,MAAM;YACtB,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CACV,aAAa,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,CAChE,CACF;gBACH,OAAO,EAAE,IAAI,CAAA;;;yBAGI;aAClB,CAAC,CAAC;QAEL,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC;QACnE,IAAI,SAAS,CAAC,MAAM;YAClB,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAClE;gBACH,OAAO,EAAE,IAAI,CAAA;iCACY,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO;;yBAE5C;aAClB,CAAC,CAAC;QAEL,OAAO,KAAK,CAAC;IACf,CAAC;IAED,oBAAoB,CAAC,WAAoB;QACvC,MAAM,IAAI,GAAG,WAAW,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;QACxD,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,WAAW,CAAC,CAAC;QAC5B,MAAM,MAAM,GAAU,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACzD,MAAM,KAAK,GAAe;YACxB;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;gBAClD,CAAC;aACF;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,kBAAkB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,CACxD;aACJ;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,QAAQ;;yBAEG;gBACjB,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;aAC9D;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,WAAW,CAAC,CAAC;aACxE;YACD,IAAI;gBACF,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;iBAChE;gBACH,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC;iBAC3C;YACL;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,WAAW,CAAC,CAAC;aACnE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,MAAM,KAAK,GAAW,EAAE,CAAC;oBACzB,KAAK,CAAC,IAAI,CACR,WAAW,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,CACvD,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;oBAC/D,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;oBAClC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;gBAC1C,CAAC;aACF;SACF,CAAC;QAEF,MAAM,IAAI,GAAG,WAAW,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACvD,MAAM,YAAY,GAChB,WAAW,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,CAAC,MAAM,CAAC;QAE5D,IAAI,IAAI,KAAK,MAAM,IAAI,CAAC,IAAI,KAAK,UAAU,IAAI,YAAY,KAAK,CAAC,CAAC;YAChE,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC;aAC7C,CAAC,CAAC;QAEL,OAAO,KAAK,CAAC;IACf,CAAC;IAED,kBAAkB,CAAC,SAAkB;QACnC,MAAM,WAAW,GAAG,SAAS,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;QAC7D,MAAM,KAAK,GAAe;YACxB;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;aAC3C;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC;gBAChD,CAAC;aACF;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;aACpE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,QAAQ;;yBAEG;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;aACjE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC;aACtE;YACD,WAAW;gBACT,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;iBAC1D;gBACH,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;iBACzC;YAEL;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;aACjE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,MAAM,KAAK,GAAW,EAAE,CAAC;oBACzB,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CACpE,KAAK,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,QAAQ,CAAC,CAAC,CACxC,CAAC;oBACF,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAAC;oBAChC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;gBAC1C,CAAC;aACF;SACF,CAAC;QAEF,MAAM,EAAE,GAAG,EAAE,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;QACtC,MAAM,KAAK,GAAG;YACZ,OAAO,EAAE,CAAC,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,CAAC;YAC3C,MAAM,EAAE,CAAC,aAAa,EAAE,eAAe,EAAE,aAAa,EAAE,cAAc,CAAC;YACvE,UAAU,EAAE;gBACV,eAAe;gBACf,aAAa;gBACb,iBAAiB;gBACjB,YAAY;aACb;SACF,CAAC;QACF,MAAM,KAAK,GAAG;YACZ,OAAO,EAAE;gBACP,aAAa;gBACb,eAAe;gBACf,gBAAgB;gBAChB,cAAc;aACf;YACD,MAAM,EAAE,CAAC,YAAY,EAAE,cAAc,EAAE,eAAe,EAAE,aAAa,CAAC;YACtE,UAAU,EAAE;gBACV,YAAY;gBACZ,cAAc;gBACd,eAAe;gBACf,aAAa;aACd;SACF,CAAC;QACF,MAAM,IAAI,GAAG,CAAC,IAAyC,EAAE,GAAY,EAAE,EAAE,CACvE,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,CAAC,IAAyC,EAAE,GAAY,EAAE,EAAE,CACvE,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,CAAC,IAAyC,EAAE,GAAY,EAAE,EAAE,CACvE,IAAI,CAAA;gBACM,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC;mCACI,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC;uBAC3B,CAAC;QAEpB,MAAM,WAAW,GAAG,SAAS,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;QACnE,MAAM,cAAc,GAAG,SAAS,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;QAE5E,IAAI,cAAc;YAChB,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,CAAC;gBAClE,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE,KAAK,CAAC;aACnC,CAAC,CAAC;aACA,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM,CAAE,CAAC,EAAE;YAC7D,KAAK,CAAC,OAAO,CACX;gBACE,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,oBAAoB,CAAC;oBACnB,IAAI,EAAE,SAAS;oBACf,YAAY,EAAE,IAAI;oBAClB,IAAI,EAAE,qBAAqB,CAAC,SAAS,CAAC,CAAC,EAAE;iBAC1C,CAAC,CACH;gBACH,OAAO,EAAE,IAAI,CAAC,SAAS,EAAE,KAAK,CAAC;aAChC,EACD;gBACE,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC;gBACnD,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC;aAC/B,CACF,CAAC;SACH;QACD,IAAI,WAAW;YACb,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;gBAC/D,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC;aAClC,CAAC,CAAC;;YAEH,KAAK,CAAC,OAAO,CACX;gBACE,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,oBAAoB,CAAC;oBACnB,IAAI,EAAE,SAAS;oBACf,YAAY,EAAE,IAAI;oBAClB,IAAI,EAAE,qBAAqB,CAAC,SAAS,CAAC,CAAC,EAAE;iBAC1C,CAAC,CACH;gBACH,OAAO,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC;aAC/B,EACD;gBACE,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC;gBACnD,OAAO,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC;aAC9B,CACF,CAAC;QACJ,OAAO,KAAK,CAAC;IACf,CAAC;IAED,eAAe,CAAC,MAAe;QAC7B,MAAM,IAAI,GAAG,MAAM,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;QACnD,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;QACvB,MAAM,MAAM,GAAU,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACzD,MAAM,KAAK,GAAe;YACxB;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,YAAY;;yBAED;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;aACjE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,QAAQ;;yBAEG;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;aACtE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC;aACnE;YACD,IAAI;gBACF,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;iBAChE;gBACH,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;iBACtC;YAEL;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;aAC9D;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,MAAM,IAAI,GAAG,MAAM,CAAC,aAAa,CAAC,kBAAkB,CAAE,CAAC;oBACvD,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC,CAAC,GAAG,UAAU,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC,CACtD,CAAC;gBACJ,CAAC;aACF;SACF,CAAC;QACF,OAAO,KAAK,CAAC;IACf,CAAC;IAED,kBAAkB,CAAC,OAAgB;QACjC,MAAM,IAAI,GAAG,OAAO,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;QACpD,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACxB,MAAM,MAAM,GAAU,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACzD,MAAM,KAAK,GAAe;YACxB;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,YAAY;;yBAED;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;aAClE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,kBAAkB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,CACpD;aACJ;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,QAAQ;;yBAEG;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;aACvE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,OAAO,CAAC,CAAC;aACpE;YACD,IAAI;gBACF,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;iBAChE;gBACH,CAAC,CAAC;oBACE,OAAO,EAAE,IAAI,CAAA;;;6BAGI;oBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;iBACvC;YAEL;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;aAC/D;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,MAAM,KAAK,GAAW,EAAE,CAAC;oBACzB,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,kBAAkB,CAAC,CAAC,CAAC,OAAO,CAClE,KAAK,CAAC,EAAE;wBACN,IACE,KAAK,CAAC,IAAI,CACR,IAAI,CAAC,GAAG,CAAC,gBAAgB,CACvB,sBAAsB,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CACzD,CACF,CAAC,IAAI,CACJ,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,OAAO,CAC1D;4BAED,KAAK,CAAC,IAAI,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;oBACrC,CAAC,CACF,CAAC;oBACF,KAAK,CAAC,IAAI,CACR,OAAO,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,CACnD,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;wBACnB,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAClC,8BAA8B,QAAQ,CAAC,YAAY,CACjD,kBAAkB,CACnB,IAAI,CACN,CAAC;wBACF,IAAI,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,OAAO;4BACrD,KAAK,CAAC,IAAI,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;oBACrC,CAAC,CAAC,CAAC;oBACH,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC;oBAC9B,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;gBAC1C,CAAC;aACF;SACF,CAAC;QACF,OAAO,KAAK,CAAC;IACf,CAAC;IAED,aAAa,CAAC,IAAa;QACzB,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;QAC3C,MAAM,KAAK,GAAe;YACxB;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC;gBAC3C,CAAC;aACF;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;qBAGA,KAAK;;;;;;cAMZ,QAAQ;;yBAEG;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC;aACjE;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;aAC5D;YACD;gBACE,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;gBACnD,CAAC;aACF;SACF,CAAC;QAEF,IAAI,MAAM,KAAK,GAAG;YAChB,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;wBACX,OAAO,EAAE,IAAI;wBACb,UAAU,EAAE;4BACV,CAAC,GAAG,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE;yBAC9D;qBACF,CAAC,CACH,CAAC;gBACJ,CAAC;aACF,CAAC,CAAC;QAEL,IAAI,MAAM,KAAK,GAAG;YAChB,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;wBACX,OAAO,EAAE,IAAI;wBACb,UAAU,EAAE;4BACV,CAAC,GAAG,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;yBAC7D;qBACF,CAAC,CACH,CAAC;gBACJ,CAAC;aACF,CAAC,CAAC;QAEL,IAAI,KAAK,CAAC,WAAW,EAAE,KAAK,SAAS;YACnC,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,IAAI,CAAA;;;;;;yBAMI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;wBACX,OAAO,EAAE,IAAI;wBACb,UAAU,EAAE;4BACV,CAAC,GAAG,IAAI,CAAC,GAAG,QAAQ,CAAC,EAAE;gCACrB,YAAY,EAAE,KAAK;gCACnB,KAAK,EAAE,SAAS;6BACjB;yBACF;qBACF,CAAC,CACH,CAAC;gBACJ,CAAC;aACF,CAAC,CAAC;QAEL,IAAI,KAAK,CAAC,WAAW,EAAE,KAAK,SAAS;YACnC,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,IAAI,CAAA;;;;;;yBAMI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;wBACX,OAAO,EAAE,IAAI;wBACb,UAAU,EAAE;4BACV,CAAC,GAAG,IAAI,CAAC,GAAG,QAAQ,CAAC,EAAE;gCACrB,YAAY,EAAE,KAAK;gCACnB,KAAK,EAAE,SAAS;6BACjB;yBACF;qBACF,CAAC,CACH,CAAC;gBACJ,CAAC;aACF,CAAC,CAAC;QAEL,IAAI,KAAK,KAAK,MAAM;YAClB,KAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,IAAI,CAAA;;;yBAGI;gBACjB,OAAO,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;wBACX,OAAO,EAAE,IAAI;wBACb,UAAU,EAAE;4BACV,CAAC,GAAG,IAAI,CAAC,GAAG,QAAQ,CAAC,EAAE;gCACrB,YAAY,EAAE,KAAK;gCACnB,KAAK,EAAE,IAAI;6BACZ;yBACF;qBACF,CAAC,CACH,CAAC;gBACJ,CAAC;aACF,CAAC,CAAC;QAEL,OAAO,KAAK,CAAC;IACf,CAAC;IAED,UAAU;QACR,IAAI,CAAC,IAAI,CAAC,IAAI;YAAE,OAAO,IAAI,CAAA,EAAE,CAAC;QAC9B,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;QAE9B,MAAM,KAAK,GAAe;YACxB,EAAE,OAAO,EAAE,gBAAgB,CAAC,OAAO,CAAC,EAAE;YACtC,EAAE,OAAO,EAAE,IAAI,CAAA,oCAAoC,EAAE;SACtD,CAAC;QACF,IAAI,OAAO,CAAC,OAAO,KAAK,qBAAqB;YAC3C,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;aAC7C,IAAI,OAAO,CAAC,OAAO,KAAK,kBAAkB;YAC7C,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC;aAC/C,IAAI,OAAO,CAAC,OAAO,KAAK,KAAK,IAAI,QAAQ,CAAC,OAAO,CAAC;YACrD,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,CAAC;aAC1C,IAAI,OAAO,CAAC,OAAO,KAAK,KAAK,IAAI,OAAO,CAAC,OAAO,KAAK,cAAc;YACtE,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;aAC7C,IAAI,OAAO,CAAC,OAAO,KAAK,oBAAoB,EAAE;YACjD,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,2BAA2B,CAAC,OAAO,CAAC,CAAC,CAAC;YACzD,MAAM,WAAW,GAAG,OAAO,CAAC,aAAc,CAAC;YAC3C,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,CAAA,oCAAoC,EAAE,CAAC,CAAC;YAClE,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,gBAAgB,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;YACvD,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,CAAA,oCAAoC,EAAE,CAAC,CAAC;YAClE,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,CAAC,CAAC;SACvD;aAAM,IAAI,OAAO,CAAC,OAAO,KAAK,MAAM,EAAE;YACrC,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC;YAC3C,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,CAAA,oCAAoC,EAAE,CAAC,CAAC;YAClE,KAAK,CAAC,IAAI,CAAC;gBACT,OAAO,EAAE,gBAAgB,CAAC,OAAO,CAAC,aAAc,CAAC;aAClD,CAAC,CAAC;SACJ;QAED,MAAM,YAAY,GAChB,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;YAC5B,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;YAC5B,CAAC,OAAO,CAAC,OAAO,KAAK,MAAM,IAAI,OAAO,CAAC,WAAW,CAAC;YACjD,CAAC,CAAC,EAAE;YACJ,CAAC,CAAC,EAAE,CAAC;QAET,OAAO,IAAI,CAAA;;;sBAGO,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,YAAY,aAAa,IAAI,CAAC,IAAI;aAC7D,IAAI;UACL,GAAG,CAAC,KAAK,EAAE,IAAc,EAAE,EAAE;YAC7B,IAAI,CAAC,CAAC,IAAI,YAAY,WAAW,CAAC;gBAAE,OAAO;YAC3C,MAAM,IAAI,CAAC,cAAc,CAAC;YAC1B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;YACvD,IAAI,MAAM,GAAG,MAAM,CAAC,WAAW,EAAE;gBAC/B,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;gBACjC,6CAA6C;gBAC7C,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;gBAC1B,6CAA6C;gBAC7C,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,oBAAoB,CAAC;aAC7C;YACD,IAAI,KAAK,GAAG,MAAM,CAAC,UAAU,EAAE;gBAC7B,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;gBAClC,6CAA6C;gBAC7C,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;aAC1B;QACH,CAAC,CAAC;;;sBAGY,CAAC,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,EAAuB,EAAE,EAAE;;YACzD,MAAA,MAAA,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,0CAAE,OAAO,kDAAI,CAAC;YACvD,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC;QACxB,CAAC;;YAEC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC;;;KAGhC,CAAC;IACJ,CAAC;IAED,MAAM;;QACJ,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAEhC,MAAM,aAAa,GACjB,CAAA,MAAA,IAAI,CAAC,OAAO,0CAAE,OAAO,MAAK,cAAc;YACtC,CAAC,CAAC,GAAG,CAAA,uDAAuD;YAC5D,CAAC,CAAC,OAAO,CAAC;QAEd,MAAM,wBAAwB,GAC5B,CAAA,MAAA,IAAI,CAAC,OAAO,0CAAE,OAAO,MAAK,kBAAkB;YAC1C,CAAC,CAAC,GAAG,CAAA,uDAAuD;YAC5D,CAAC,CAAC,OAAO,CAAC;QAEd,MAAM,kBAAkB,GAAG,IAAI,CAAC,YAAY;YAC1C,CAAC,CAAC,GAAG,CAAA;eACI,GAAG,EAAE;gBACZ,MAAM,OAAO,GAAG,IAAI,CAAC,YAAa,CAAC;gBACnC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;gBACnD,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAC5D,CAAC;SACE;YACH,CAAC,CAAC,OAAO,CAAC;QAEZ,IAAI,cAAc,GAAG,GAAG,CAAA,EAAE,CAAC;QAC3B,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,cAAc,IAAI,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC;gBAChE,cAAc,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;iBACvD,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,qBAAqB;gBACrD,cAAc,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;iBACpE,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,kBAAkB;gBAClD,cAAc,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;iBAC9D,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC;gBAC7B,cAAc,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACpD;QAED,IAAI,WAAW,GAAG,IAAI,CAAA,EAAE,CAAC;QACzB,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,IAAI,MAAM,GAAG,IAAI,CAAC;QAElB,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,MAAM,EACJ,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,GACd,GAAG,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC7B,MAAM,GAAG,KAAK,CAAC;YACf,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;YAC9C,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;YAChC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;YAChC,OAAO,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;YACvD,WAAW,GAAG,IAAI,CAAA,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;SAC/B;QAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE;YACjD,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChC,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAC9C,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAC9C,MAAM,GAAG,KAAK,CAAC;YACf,OAAO,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YACzD,WAAW,GAAG,IAAI,CAAA,GAAG,IAAI,UAAU,IAAI,EAAE,CAAC;SAC3C;QAED,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EACX,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,GAClB,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChC,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;YACjD,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;YACjD,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC;YACjD,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC;YACjD,MAAM,GAAG,KAAK,CAAC;YACf,OAAO,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YACvE,WAAW,GAAG,IAAI,CAAA,GAAG,IAAI,UAAU,IAAI,EAAE,CAAC;SAC3C;QAED,MAAM,iBAAiB,GAAG,IAAI,CAAA;QAC1B,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC;eACjB,QAAQ,CAAC,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC;;SAEtD,WAAW;WACT,CAAC;QAER,MAAM,iBAAiB,GAAG,EAAE,CAAC;QAC7B,IAAI,CAAA,MAAA,IAAI,CAAC,UAAU,0CAAE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAK,IAAI,CAAC,UAAU,EAAE;YACnE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;YACrD,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,OAAO,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC1B,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;gBACzB,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBAC7B,iBAAiB,CAAC,IAAI,CACpB,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE;0DACH,CACjD,CAAC;gBACF,CAAC,IAAI,CAAC,CAAC;aACR;YAED,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAClD,MAAM,QAAQ,GAAG,EAAE,KAAK,KAAK,CAAC;YAE9B,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;YACtB,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;YAEtB,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;YAExB,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CACzB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,qBAAqB,CAAC,CACxD;iBACE,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC;iBACzB,IAAI,CAAC,EAAE,CAAC,EAAE;gBACT,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,EAAE,CAAC,CAAC;gBACnB,OAAO,CAAC,KAAK,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,CAAC;YAChD,CAAC,CAAC,CAAC;YAEL,MAAM,UAAU,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;YAEtD,IAAI,QAAQ,IAAI,UAAU,EAAE;gBAC1B,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,GAAG,qBAAqB,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC;gBACjE,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC;gBACf,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC;aAClB;YAED,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;YACjC,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;YAEjC,iBAAiB,CAAC,IAAI,CACpB,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE;0DACD,EAClD,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE;0DACD,EAClD,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE;0DACD,CACnD,CAAC;YACF,iBAAiB,CAAC,IAAI,CACpB,GAAG,CAAA;eACI,GAAG,EAAE;gBACZ,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBACjC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBACpB,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBACpB,SAAS,CAAC,IAAI,CAAC,CAAC;gBAChB,IAAI,CAAC,aAAa,EAAE,CAAC;gBACrB,IAAI,QAAQ,IAAI,UAAU;oBACxB,IAAI,CAAC,aAAa,CAChB,eAAe,CAAC;wBACd,IAAI;wBACJ,YAAY;wBACZ,IAAI;wBACJ,EAAE,EAAE,QAAQ;wBACZ,UAAU;qBACX,CAAC,CACH,CAAC;YACN,CAAC,KAAK,CACL,CAAC;SACH;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAE/B,OAAO,IAAI,CAAA;;UAEL,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,MAAM,CAAC;;;;mBAI3B,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;;;;;;;mBAOhD,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE;;;qBAGlC,KAAK;;;;;;cAMZ,UAAU;;;;;;mBAML,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;;;;;;;mBAOpD,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE;;;;;;iBAMtB,KAAK;uBACC,OAAO;;uBAEP,CAAC,IAAI,CAAC;iBACZ,CAAC,GAAG,IAAI,CAAC,QAAQ;kBAChB,CAAC,GAAG,IAAI,CAAC,QAAQ;;;qBAGd,CAAC,CAAa,EAAE,EAAE;YAC7B,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;YACzD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YACrC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YACrC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YACtC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YACtC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;QAC9B,CAAC;;;;;;;uBAOc,aAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;UA2B1B,OAAO;;UAEP,aAAa;UACb,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC;aACnC,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,KAAK,cAAc,CAAC;aACjD,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAA,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,EAAE,CAAC;UAC5C,iBAAiB;UACjB,CAAA,MAAA,IAAI,CAAC,UAAU,0CAAE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAK,IAAI,CAAC,UAAU;YAC/D,CAAC,CAAC,KAAK,CAAC,IAAI,CACR,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,qBAAqB,CAAC,CACxD,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;YAC1D,CAAC,CAAC,OAAO;UACT,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;aAC/D,MAAM,CACL,IAAI,CAAC,EAAE,CACL,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,UAAU;YACxC,CAAC,CACC,IAAI,CAAC,OAAO;gBACZ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,CACpD;YACD,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAc,CAAC,CACjC;aACA,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;UACjD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;aAC/D,MAAM,CACL,IAAI,CAAC,EAAE,CACL,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,UAAU;YACxC,CAAC,CACC,IAAI,CAAC,OAAO;gBACZ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,CACpD;YACD,QAAQ,CAAC,IAAI,CAAC,aAAc,CAAC,CAChC;aACA,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;UACjD,KAAK,CAAC,IAAI,CACV,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,2BAA2B,CAAC,CAC9D,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,WAAW,CAAC,CAAC;UAC5D,KAAK,CAAC,IAAI,CACV,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAC9B,gEAAgE,CACjE,CACF;aACE,MAAM,CACL,CAAC,CAAC,EAAE,CACF,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,CACpE;aACA,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;UAC1C,wBAAwB,IAAI,kBAAkB,IAAI,cAAc;;QAElE,IAAI,IAAI,iBAAiB;;;0BAGP,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,MAAM,CAAC;;;;;;;;;qBASzC,CAAC;;;iCAGW,CAAC,KAAa,EAAE,QAAuB,EAAE,EAAE;YAC9D,MAAM,EACJ,GAAG,EAAE,CAAC,EAAE,EAAE,IAAI,CAAC,GAChB,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChC,IACE,QAAQ,CAAC,KAAK;gBACd,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,EAC7D;gBACA,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC;aAC/C;YACD,OAAO,EAAE,CAAC;QACZ,CAAC;;;;;;;;qBAQQ,CAAC;;iCAEW,CAAC,KAAa,EAAE,QAAuB,EAAE,EAAE;YAC9D,MAAM,EACJ,GAAG,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,GAChB,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChC,IACE,QAAQ,CAAC,KAAK;gBACd,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,EAC7D;gBACA,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC;aAC/C;YACD,OAAO,EAAE,CAAC;QACZ,CAAC;;;;;mBAKM,GAAG,EAAE;YACZ,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CACtB,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAC1D,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,aAAa,EAAE,CAAC,CAAC;YAChD,IAAI,CAAC,KAAK;gBAAE,OAAO;YACnB,MAAM,EACJ,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,GAClB,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG;gBACnB,IAAI,CAAC,iBAAiB;gBACtB,IAAI,CAAC,kBAAkB;aACxB,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,WAAC,OAAA,QAAQ,CAAC,MAAA,EAAE,CAAC,KAAK,mCAAI,GAAG,EAAE,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAA,EAAA,CAAC,CAAC;YACtD,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,CAAC;YAChC,IAAI,IAAI,KAAK,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,KAAK,IAAI,CAAC,QAAQ,EAAE;gBAAE,OAAO;YACjE,IAAI,CAAC,aAAa,CAChB,YAAY,CAAC;gBACX,OAAO,EAAE,IAAI,CAAC,UAAU;gBACxB,UAAU,EAAE;oBACV,CAAC,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;oBACvD,CAAC,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;iBACxD;aACF,CAAC,CACH,CAAC;QACJ,CAAC;;;;;;;;;;;;eAYI,CAAC;IACd,CAAC;IAED,WAAW,CAAC,OAAgB;;QAC1B,IAAI,CAAC,IAAI,CAAC,UAAU;YAAE,OAAO,OAAO,CAAC;QAErC,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,IAAI,IAAI,GACN,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC/B,IAAI,MAAM,GAAG,GAAG,CAAC;QACjB,IAAI,KAAK,GAAG,OAAO,CAAC;QACpB,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;QAEnD,IAAI,OAAO,CAAC,OAAO,KAAK,MAAM,EAAE;YAC9B,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;YAC1C,GAAG,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC;YACnC,IAAI,OAAO,CAAC,WAAW;gBACrB,IAAI,GAAG,MAAA,OAAO,CAAC,WAAW,0CAAE,KAAK,CAAC,OAAO,EAAE,GAAG,CAC5C,CAAC,IAAI,EAAE,CAAC,EAAE,EAAE,CACV,GAAG,CAAA;uBACQ,CAAC,GAAG,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ;gCACnC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ;oBACrC,IAAI,IAAI,GAAG;yBACN,CAChB,CAAC;iBACC;gBACH,IAAI,GAAG,wBAAwB,CAAC;gBAChC,KAAK,GAAG,MAAM,CAAC;gBACf,MAAM,GAAG,GAAG,CAAC;aACd;SACF;QAED,MAAM,QAAQ,GAAG,OAAO,CAAC,OAAO,KAAK,qBAAqB,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC;QACxE,IAAI,MAAM,GAAG,MAAM,CAAC;QACpB,IAAI,WAAW,GAA0B,OAAO,CAAC;QACjD,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,MAAM,GAAG,KAAK,CAAC;YACf,MAAM,MAAM,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,CAAC,GAAG,GAAG,EAAE,IAAI,CAAC,OAAO,GAAG,CAAC,GAAG,GAAG,CAAU,CAAC;YACzE,WAAW,GAAG,GAAG,EAAE,CACjB,IAAI,CAAC,aAAa,CAAC,uBAAuB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;SAChE;QACD,MAAM,EAAE,GACN,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,UAAU;YACjD,OAAO,CAAC,OAAO,KAAK,MAAM;YACxB,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC;YACnB,CAAC,CAAC,OAAO,CAAC;QACd,MAAM,OAAO,GAAG,QAAQ,CAAC;YACvB,KAAK,EAAE,IAAI;YACX,SAAS,EACP,CAAC,OAAO,CAAC,OAAO,KAAK,KAAK,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;gBACjD,OAAO,CAAC,OAAO,KAAK,cAAc;SACrC,CAAC,CAAC;QACH,OAAO,GAAG,CAAA,aAAa,OAAO,eAAe,EAAE;qCACd,GAAG,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,GAAG;mBAC3C,CAAC,GAAG,GAAG,QAAQ,CAAC,GAAG,GAAG;;uBAElB,cAAc;sBACf,CAAC,CAAa,EAAE,EAAE;YAC5B,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;gBAClB,sBAAsB;gBACtB,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;gBAChD,CAAC,CAAC,cAAc,EAAE,CAAC;aACpB;QACH,CAAC;mBACQ,WAAW;yBACL,CAAC,CAAa,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC;4BACzC,MAAM,WAAW,KAAK,kBAAkB,MAAM;uBACnD,QAAQ;;YAEnB,IAAI;;WAEL,CAAC;IACV,CAAC;IAED,eAAe,CAAC,OAAgB,EAAE,OAAO,GAAG,KAAK;;QAC/C,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,KAAK,cAAc,CAAC;QAChD,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,IAAI,CAAC,OAAO;YAAE,OAAO,GAAG,CAAA,EAAE,CAAC;QAEvD,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;QAC5C,MAAM,MAAM,GAAU,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACzD,IAAI,EACF,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC;QACxB,IAAI,WAAW,GAAG,CAAC,CAAa,EAAE,EAAE;YAClC,IAAI,IAAI,CAAC,IAAI;gBACX,IAAI,CAAC,aAAa,CAChB,kBAAkB,CAChB,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,EAC9C,MAAM,CACP,CACF,CAAC;QACN,CAAC,CAAC;QACF,IAAI,OAAO,GAAG,KAAK,CAAC;QAEpB,IAAI,IAAI,CAAC,UAAU,KAAK,OAAO,EAAE;YAC/B,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YACrC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YACrC,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC;gBACjC,WAAW,GAAG,GAAG,EAAE,CACjB,IAAI,CAAC,aAAa,CAChB,cAAc,CAAC;oBACb,CAAC;oBACD,CAAC;oBACD,OAAO,EAAE,OAAO;iBACjB,CAAC,CACH,CAAC;;gBACD,OAAO,GAAG,IAAI,CAAC;SACrB;QAED,MAAM,KAAK,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACxB,MAAM,MAAM,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACzB,IAAI,IAAI,CAAC,UAAU,KAAK,OAAO,EAAE;YAC/B,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;YACrC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;YACrC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;YACjC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAClC,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;gBACzC,WAAW,GAAG,GAAG,EAAE,CACjB,IAAI,CAAC,aAAa,CAChB,gBAAgB,CAAC;oBACf,CAAC;oBACD,CAAC;oBACD,CAAC;oBACD,CAAC;oBACD,OAAO,EAAE,OAAO;iBACjB,CAAC,CACH,CAAC;;gBACD,OAAO,GAAG,IAAI,CAAC;SACrB;QAED,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,EAAE;YAC5B,IAAI,MAA2B,CAAC;YAChC,IAAI,IAAI;gBAAE,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC;;gBAEjC,MAAM,GAAG,KAAK,CAAC,IAAI,CACjB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,mCAAmC,CAAC,CACtE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAC7C,IAAI,MAAM,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;gBAChD,WAAW,GAAG,GAAG,EAAE,CACjB,IAAI,CAAC,aAAa,CAChB,aAAa,CAAC;oBACZ,CAAC;oBACD,CAAC;oBACD,OAAO,EAAE,OAAO;oBAChB,MAAM,EAAE,MAAO;iBAChB,CAAC,CACH,CAAC;;gBACD,OAAO,GAAG,IAAI,CAAC;SACrB;QAED,IAAI,aAAa,GAAG,GAAG,CAAA,EAAE,CAAC;QAC1B,IAAI,cAAc,GAAG,GAAG,CAAA,EAAE,CAAC;QAC3B,IACE,CAAC,IAAI,IAAI,CAAA,MAAA,IAAI,CAAC,OAAO,0CAAE,OAAO,MAAK,KAAK,CAAC;YACzC,CAAC,CAAC,IAAI,IAAI,CAAA,MAAA,IAAI,CAAC,OAAO,0CAAE,OAAO,MAAK,qBAAqB,CAAC;YAE1D,aAAa,GAAG,GAAG,CAAA,YAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC;iBACzD,WAAW,uBAAuB,CAAC;QAEhD,IACE,IAAI,CAAC,UAAU,KAAK,OAAO;YAC3B,IAAI,CAAC,UAAU,KAAK,OAAO;YAC3B,CAAC,CAAA,MAAA,IAAI,CAAC,UAAU,0CAAE,aAAa,MAAK,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEzE,cAAc,GAAG,GAAG,CAAA,YAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC;iBAC1D,WAAW,IAAI,OAAO,uBAAuB,CAAC;QAE3D,MAAM,cAAc,GAAG,IAAI,CAAC,IAAI;YAC9B,CAAC,CAAC,GAAG,CAAA,eAAe,KAAK;;mBAEZ,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;sCACrC,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC;;YAEpD,YAAY;eACT;YACT,CAAC,CAAC,OAAO,CAAC;QACZ,MAAM,cAAc,GAAG,IAAI,CAAC,IAAI;YAC9B,CAAC,CAAC,GAAG,CAAA,eAAe,KAAK;;mBAEZ,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;sCACrC,CAAC,QAAQ,CAAC;;YAEpC,YAAY;eACT;YACT,CAAC,CAAC,OAAO,CAAC;QAEZ,MAAM,YAAY,GAChB,CAAC,IAAI,CAAC,IAAI;YACV,IAAI,CAAC,OAAO,KAAK,OAAO;YACxB,IAAI,CAAC,UAAU,KAAK,OAAO;YAC3B,IAAI,CAAC,UAAU,KAAK,OAAO,CAAC;QAE9B,OAAO,GAAG,CAAA,UACR,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,UAAU;YAC/C,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC;YACnB,CAAC,CAAC,OACN,WAAW,QAAQ,CAAC;YAClB,YAAY,EAAE,IAAI;YAClB,GAAG,EAAE,CAAC,IAAI;YACV,OAAO;SACR,CAAC,iCACA,YAAY,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAC1B;iBACa,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC;uBAC/B,CAAC,CAAa,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC;iBAClD,WAAW,IAAI,OAAO,eAAe,cAAc;oBAChD,CAAC,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAc,EAAE,EAAE;YACvD,IAAI,MAAM,KAAK,CAAC;gBAAE,OAAO;YACzB,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;YACpD,IAAI,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;gBAC5D,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC,CAAC;;gBAChD,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC,CAAC;QAC1D,CAAC;yCACgC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM;kBAC9C;QACR,6CAA6C;QAC7C,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAC3C;QACA,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;aAC3B,MAAM,CAAC,KAAK,CAAC;aACb,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;QACtC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;aAC3B,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,KAAK,qBAAqB,CAAC;aACxD,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;QAClD,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;aAC3B,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,KAAK,kBAAkB,CAAC;aACrD,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC;QAEzD,OAAO;YACL,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;iBACrD,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,UAAU,CAAC;iBAC1D,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;YACrD,CAAC,CAAC,OACN;QAEE,OAAO;YACL,CAAC,CAAC,KAAK,CAAC,IAAI,CACR,OAAO,CAAC,gBAAgB,CACtB,kDAAkD,CACnD,CACF;iBACE,MAAM,CAAC,OAAO,CAAC;iBACf,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAC9C,CAAC,CAAC,OACN;QACE,cAAc;QACd,cAAc;QACd,aAAa;QACb,cAAc;SACb,CAAC;IACR,CAAC;IAED,eAAe,CAAC,OAAgB;QAa9B,MAAM,WAAW,GAAG,OAAO,CAAC,aAAc,CAAC;QAC3C,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,MAAM,CACtD,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,KAAK,oBAAoB,CACxC,CAAC;QACF,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;QACpE,IAAI,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC,CAAU,CAAC;QAC7B,MAAM,IAAI,GAAG,GAAG,CAAC;QACjB,MAAM,QAAQ,GAAiD,EAAE,CAAC;QAClE,MAAM,SAAS,GAAsD,EAAE,CAAC;QACxE,IAAI,GAOS,CAAC;QACd,IAAI,eAAmC,CAAC;QACxC,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,MAAM,CAC1D,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,KAAK,UAAU,CAC9B,CAAC;QACF,MAAM,SAAS,GAAG,gBAAgB,CAAC,IAAI,CACrC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,CACrC,CAAC;QACF,MAAM,SAAS,GAAG,gBAAgB,CAAC,IAAI,CACrC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,CACrC,CAAC;QACF,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAC/C,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,KAAK,cAAc,CAClC,CAAC;QACF,MAAM,YAAY,GAAG,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC/C,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC,WAAW,CAAC,CAAC;QACpD,SAAS,KAAK,CAAC,KAAY,EAAE,KAAY,EAAE,MAAc;YACvD,MAAM,OAAO,GAAG,KAAK,CAAC,KAAK,EAAW,CAAC;YACvC,IAAI,KAAK,KAAK,CAAC;gBAAE,OAAO,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;;gBAC3D,OAAO,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;YACrE,OAAO,OAAO,CAAC;QACjB,CAAC;QACD,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;YACzB,IAAI,IAAI,KAAK,UAAU,EAAE;gBACvB,eAAe,GAAG,EAAE,CAAC;gBACrB,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;gBAClC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;oBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;iBACzB;gBACD,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;oBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;iBACxC;aACF;iBAAM;gBACL,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1B,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBACnC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;gBAClC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC;gBACjD,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC;gBACxC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;oBAClB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;wBACzC,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;wBAC/B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;yBAAM;wBACL,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;wBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;iBACF;gBACD,GAAG,GAAG;oBACJ,IAAI,EAAE,EAAE;oBACR,OAAO,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC;oBAC3B,EAAE,EAAE,EAAE;oBACN,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,GAAG,GAAG,CAAC;iBAC9C,CAAC;gBACF,IAAI,CAAC,SAAS,EAAE;oBACd,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;gBACD,IAAI,CAAC,SAAS,EAAE;oBACd,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;aACF;SACF;aAAM,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;YAChC,IAAI,YAAY,KAAK,CAAC,EAAE;gBACtB,MAAM,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;aAC9B;YACD,IAAI,IAAI,KAAK,MAAM,EAAE;gBACnB,IAAI,YAAY,KAAK,CAAC,EAAE;oBACtB,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;oBACnC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;oBAClC,IAAI,CAAC,OAAO,EAAE;wBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;wBAClB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;qBACnB;yBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;wBAC3D,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;4BACzC,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;4BAC/B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;yBACzB;6BAAM;4BACL,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;4BAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;yBACzB;qBACF;oBACD,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;wBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;qBACvC;iBACF;qBAAM;oBACL,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1B,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC;oBACxC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC;oBACjD,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;oBACnC,GAAG,GAAG;wBACJ,IAAI,EAAE,EAAE;wBACR,OAAO,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC;wBAC3B,EAAE,EAAE,EAAE;wBACN,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,GAAG,GAAG,CAAC;qBAC/C,CAAC;oBACF,IAAI,CAAC,SAAS;wBAAE,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;oBAClC,IAAI,CAAC,SAAS;wBAAE,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;oBAClC,IAAI,CAAC,OAAO,EAAE;wBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;qBACnB;yBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;wBAC3D,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;wBAC/B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;iBACF;aACF;iBAAM,IAAI,IAAI,KAAK,UAAU,EAAE;gBAC9B,IAAI,YAAY,KAAK,CAAC,EAAE;oBACtB,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;wBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;qBACvC;iBACF;qBAAM;oBACL,eAAe,GAAG,iBAAiB,CAAC;oBACpC,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1B,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS;wBAC1B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,GAAG,GAAG,CAAC,CAAC;oBAC/C,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC;oBACxC,IAAI,CAAC,OAAO,EAAE;wBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;qBACnB;yBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;wBAC3D,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,GAAG,GAAG,CAAC,CAAC;wBACpC,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;iBACF;aACF;iBAAM,IAAI,YAAY,KAAK,CAAC,EAAE;gBAC7B,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBACnC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBAEnC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;oBAClB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;wBACzC,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;wBAC/B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;yBAAM;wBACL,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;wBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;iBACF;gBACD,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;oBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;iBACxC;aACF;iBAAM;gBACL,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBACnC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBAEnC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;oBAClB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;wBACzC,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;wBAC/B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;yBAAM;wBACL,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;wBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;iBACF;gBACD,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;oBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;iBACxC;aACF;SACF;aAAM,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;YAChC,IAAI,YAAY,KAAK,CAAC,EAAE;gBACtB,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;oBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;iBACxC;gBACD,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBACnC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;gBACnC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;oBAClB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;wBACzC,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;wBAC/B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;yBAAM;wBACL,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;wBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;qBACzB;iBACF;aACF;iBAAM,IAAI,YAAY,KAAK,CAAC,EAAE;gBAC7B,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC5C,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;oBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;iBACvC;gBACD,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;gBAClC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;oBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;iBACzB;aACF;iBAAM,IAAI,YAAY,KAAK,CAAC,EAAE;gBAC7B,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC7C,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,EAAE;oBAC5B,SAAS,CAAC,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;iBACxC;gBACD,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;gBAClC,IAAI,CAAC,OAAO,EAAE;oBACZ,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;iBACnB;qBAAM,IAAI,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,UAAU,EAAE;oBAC3D,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;oBAC9B,QAAQ,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;iBACzB;aACF;SACF;QACD,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,EAAE,eAAe,EAAE,CAAC;IACrE,CAAC;IAED,wBAAwB,CAAC,OAAgB;QACvC,MAAM,EACJ,IAAI,EACJ,MAAM,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAChB,SAAS,EACT,QAAQ,EACR,GAAG,EACH,eAAe,GAChB,GAAG,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;QAClC,MAAM,KAAK,GAAwB,EAAE,CAAC;QACtC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE;YAC7D,KAAK,CAAC,IAAI,CACR,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,uEAAuE,CAC3H,CAAC;QACJ,CAAC,CAAC,CAAC;QACH,MAAM,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC1C,IACE,CAAC,CACC,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,YAAY;YACjB,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CACvE;YAED,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,EAAE;gBAClD,IAAI,CAAC,KAAK;oBAAE,OAAO;gBACnB,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC;gBACrB,MAAM,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBAC/C,MAAM,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;gBAC/C,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBACtC,MAAM,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC;gBAC5C,KAAK,CAAC,IAAI,CAAC,GAAG,CAAA,4BAA4B,CAAC,SAAS,CAAC;6BAChC,CAAC,CAAa,EAAE,EAAE;oBAC/B,IAAI,QAAQ;wBAAE,OAAO;oBACrB,CAAC,CAAC,cAAc,EAAE,CAAC;oBACnB,CAAC,CAAC,wBAAwB,EAAE,CAAC;oBAC7B,IAAI,CAAC,IAAI,CAAC,IAAI;wBAAE,OAAO;oBACvB,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,IAAiC,CAAC,CAAC;gBAClE,CAAC;uBACQ,CAAC,CAAa,EAAE,EAAE;oBACzB,CAAC,CAAC,wBAAwB,EAAE,CAAC;oBAC7B,IAAI,CAAC,IAAI,CAAC,IAAI;wBAAE,OAAO;oBACvB,IAAI,CAAC,aAAa,CAChB,oBAAoB,CAAC;wBACnB,IAAI,EAAE,OAAO;wBACb,YAAY,EAAE,IAAiC;wBAC/C,IAAI,EAAE;4BACJ,CAAC,CAAC,EAAE,CAAC,CAAC;4BACN,CAAC,EAAE,EAAE,EAAE,CAAC;yBACT;qBACF,CAAC,CACH,CAAC;gBACJ,CAAC;uBACQ,IAAI;wBACH,UAAU,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC;YACpE,CAAC,CAAC,CAAC;QACL,IAAI,SAAS,GAAG,KAAK,CAAC;QACtB,IAAI,OAAO,GAAG,GAAG,CAAA,EAAE,CAAC;QACpB,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,UAAU,CAAC,OAAO,CAAC,aAAc,CAAC,CAAC;QACzD,IAAI,GAAG,EAAE;YACP,MAAM,EACJ,IAAI,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EACd,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,EACnB,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EACZ,KAAK,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,GAClB,GAAG,GAAG,CAAC;YACR,IAAI,CAAC,IAAI,IAAI,GAAG,GAAG,EAAE;gBAAE,SAAS,GAAG,IAAI,CAAC;YACxC,IAAI,IAAI,IAAI,GAAG,GAAG,EAAE;gBAAE,SAAS,GAAG,IAAI,CAAC;YACvC,OAAO,GAAG,GAAG,CAAA,cAAc,EAAE,IAAI,EAAE,MAAM,GAAG,IAAI,GAAG,KAAK,GAAG,IAAI,GAAG,KAAK,EAAE,IAAI,EAAE,yCAAyC,CAAC;SAC1H;QACD,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;QACvD,MAAM,QAAQ,GAAG,UAAU;YACzB,CAAC,CAAC,GAAG,CAAA,aAAa,EAAE,GAAG,GAAG,SAAS,EAAE,GAAG,GAAG,SAAS,EAAE,GAAG,GAAG,SACxD,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAC3B;6EACqE;YACvE,CAAC,CAAC,OAAO,CAAC;QACZ,MAAM,MAAM,GACV,eAAe,KAAK,SAAS;YAC3B,CAAC,CAAC,OAAO;YACT,CAAC,CAAC,GAAG,CAAA;oCACuB,GAAG,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE;4BAC5B,EAAE,GAAG,GAAG,IAAI,EAAE,GAAG,GAAG;kBAC9B,eAAe,KAAK,UAAU,MAAM,CAAC;QACnD,OAAO,GAAG,CAAA;uBACS,CAAC,CAAa,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC;mBAChD,EAAE,SAAS,EAAE,QAAQ,IAAI,0CAA0C,OAAO,GAAG,MAAM,GAAG,QAAQ,GAAG,KAAK,MAAM,CAAC;IAC9H,CAAC;IAED,sBAAsB,CACpB,WAAoB,EACpB,OAAO,GAAG,KAAK;QAEf,IAAI,IAAI,CAAC,OAAO,KAAK,WAAW,IAAI,CAAC,OAAO;YAAE,OAAO,GAAG,CAAA,EAAE,CAAC;QAC3D,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,MAAM,CACtD,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,KAAK,oBAAoB,CACxC,CAAC;QACF,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC;QAClD,MAAM,MAAM,GAAU,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAEzD,MAAM,WAAW,GACf,IAAI,CAAC,OAAO,KAAK,WAAW;YAC1B,CAAC,CAAC,GAAG,CAAA;mBACM,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,MAAM,MAAM;YAC/C,CAAC,CAAC,OAAO,CAAC;QAEd,OAAO,GAAG,CAAA,aAAa,QAAQ,CAAC,EAAE,WAAW,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;;qBAE9C,cAAc;oBACf,CAAC,CAAa,EAAE,EAAE;YAC5B,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;gBAClB,sBAAsB;gBACtB,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;gBAChD,CAAC,CAAC,cAAc,EAAE,CAAC;aACpB;QACH,CAAC;iBACQ,CAAC,CAAa,EAAE,EAAE;YACzB,IAAI,IAAI,CAAC,OAAO,KAAK,WAAW,EAAE;gBAChC,MAAM,MAAM,GACV,KAAK,CAAC,IAAI,CACR,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,6BAA6B,CAAC,CAChE;qBACE,MAAM,CACL,KAAK,CAAC,IAAI,CACR,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,uBAAuB,CAAC,CAC1D,CACF;qBACA,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC;gBACjE,IAAI,CAAC,aAAa,CAChB,aAAa,CAAC;oBACZ,OAAO,EAAE,WAAW;oBACpB,MAAM;oBACN,CAAC;oBACD,CAAC;iBACF,CAAC,CACH,CAAC;aACH;YAED,IAAI,CAAC,IAAI,CAAC,IAAI;gBAAE,OAAO;YAEvB,IAAI,OAAO,GAAG,WAAW,CAAC;YAC1B,IAAI,CAAC,CAAC,QAAQ;gBAAE,OAAO,GAAG,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;YACtD,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;QAC1D,CAAC;UACC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,CAAC;UACnD,WAAW;;2BAGb,OAAO;YACL,CAAC,CAAC;gBACE,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC;gBAC7B,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAC7D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CACvB;aACF;YACH,CAAC,CAAC,OACN,MAAM,CAAC;IACX,CAAC;IAED,eAAe,CACb,SAAkB,EAClB,EAAE,OAAO,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK,EAAE,GAAG,EAAE;;QAEzC,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,IAAI,CAAC,OAAO;YAAE,OAAO,GAAG,CAAA,EAAE,CAAC;QACzD,IACE,CAAA,MAAA,IAAI,CAAC,UAAU,0CAAE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAK,IAAI,CAAC,UAAU;YAC/D,CAAC,OAAO;YAER,OAAO,GAAG,CAAA,EAAE,CAAC;QAEf,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;QAChD,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;QAC5C,MAAM,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;QAErB,MAAM,MAAM,GAAG,SAAS,CAAC,YAAY,CAAC,MAAM,CAAE,CAAC;QAC/C,MAAM,MAAM,GAAG,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACzC,MAAM,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,qBAAqB,CAAC;QACjE,MAAM,IAAI,GAAG,MAAM;YACjB,CAAC,CAAC,GAAG,CAAA;;;;;MAKL,UAAU;SACP;YACH,CAAC,CAAC,GAAG,CAAA,eAAe,MAAM,kBAAkB,MAAM;uCACjB,CAAC;QAEpC,IAAI,WAAW,GAAG,CAAC,CAAa,EAAE,EAAE;YAClC,IAAI,OAAO,GAAG,SAAS,CAAC;YACxB,IAAI,CAAC,CAAC,QAAQ;gBAAE,OAAO,GAAG,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;YACpD,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC;QAClD,CAAC,CAAC;QAEF,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,EAAE;YAC9B,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CACvB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAC9B,yCAAyC,CAC1C,CACF,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,YAAY,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAC/D,IAAI,MAAM,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;gBAClD,WAAW,GAAG,GAAG,EAAE;oBACjB,IAAI,CAAC,aAAa,CAChB,aAAa,CAAC;wBACZ,CAAC;wBACD,CAAC;wBACD,OAAO,EAAE,SAAS;wBAClB,MAAM;qBACP,CAAC,CACH,CAAC;gBACJ,CAAC,CAAC;SACL;QAED,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,MAAM,CACrD,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,KAAK,UAAU,CAC9B,CAAC;QACF,MAAM,WAAW,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,CAAC,CAAC;QACzE,MAAM,cAAc,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,IAAI,CAAC,CAAC;QAE5E,MAAM,YAAY,GAChB,WAAW;YACX,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,YAAY;YACjB,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,CAAC;YAC1C,CAAC,CAAC,OAAO;YACT,CAAC,CAAC,GAAG,CAAA;wDAEL,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAC1B;aACO,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,oBAAoB,CAAC;gBACnB,IAAI,EAAE,SAAS;gBACf,YAAY,EAAE,IAAI;gBAClB,IAAI,EAAE,qBAAqB,CAAC,SAAS,CAAC,CAAC,EAAE;aAC1C,CAAC,CACH;mBACY,CAAC,CAAa,EAAE,EAAE;gBAC/B,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YACvC,CAAC;SACI,CAAC;QAEN,MAAM,YAAY,GAChB,CAAC,IAAI,CAAC,UAAU;YAChB,IAAI,CAAC,UAAU,CAAC,IAAI,KAAK,SAAS;YAClC,CAAC,IAAI,CAAC,UAAU;gBACd,IAAI,CAAC,MAAM,KAAK,CAAC;gBACjB,IAAI,CAAC,MAAM,KAAK,CAAC;gBACjB,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,KAAK,IAAI,CAAC;YAC/C,WAAW;YACT,CAAC,CAAC,OAAO;YACT,CAAC,CAAC,GAAG,CAAA;gDACmC,CAAC;QAE7C,MAAM,WAAW,GACf,CAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,YAAY,CAAC,WAAW,CAAC,MAAK,UAAU;YACnD,CAAC,CAAC,GAAG,CAAA;qEACwD;YAC7D,CAAC,CAAC,OAAO,CAAC;QAEd,MAAM,eAAe,GACnB,cAAc;YACd,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,UAAU;YACf,IAAI,CAAC,YAAY;YACjB,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,CAAC;YAC5C,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC;YACxB,CAAC,CAAC,OAAO;YACT,CAAC,CAAC,GAAG,CAAA;wDAEL,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAC1B;aACO,GAAG,EAAE,CACZ,IAAI,CAAC,aAAa,CAChB,oBAAoB,CAAC;gBACnB,IAAI,EAAE,SAAS;gBACf,YAAY,EAAE,IAAI;gBAClB,IAAI,EAAE,qBAAqB,CAAC,SAAS,CAAC,CAAC,EAAE;aAC1C,CAAC,CACH;mBACY,CAAC,CAAa,EAAE,EAAE;gBAC/B,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YACvC,CAAC;SACI,CAAC;QAEN,MAAM,eAAe,GACnB,CAAC,IAAI,CAAC,UAAU;YAChB,IAAI,CAAC,UAAU,CAAC,IAAI,KAAK,SAAS;YAClC,CAAC,IAAI,CAAC,UAAU;gBACd,IAAI,CAAC,MAAM,KAAK,CAAC;gBACjB,IAAI,CAAC,MAAM,KAAK,CAAC;gBACjB,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,KAAK,IAAI,CAAC;YAC/C,cAAc;YACd,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC;YACxB,CAAC,CAAC,OAAO;YACT,CAAC,CAAC,GAAG,CAAA;gDACmC,CAAC;QAE7C,MAAM,cAAc,GAClB,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,YAAY,CAAC,WAAW,CAAC,MAAK,UAAU;YACtD,CAAC,CAAC,GAAG,CAAA;qEACwD;YAC7D,CAAC,CAAC,OAAO,CAAC;QAEd,MAAM,YAAY,GAAG,OAAO,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,CAAC,CAAC;QAE3E,OAAO,GAAG,CAAA,aAAa,QAAQ,CAAC;YAC9B,SAAS,EAAE,IAAI;YACf,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,SAAS;SACpC,CAAC;UAEA,SAAS,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,UAAU;YACjD,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC;YACrB,CAAC,CAAC,OACN;2BACuB,CAAC,IAAI,CAAC,YAAY,GAAG,YAC1C,IAAI,CAAC,CAAC,CAAC,8BAA8B,CAAC,CAAC,CAAC,EAC1C;eACW,SAAS,CAAC,YAAY,CAAC,MAAM,CAAC;QACrC,IAAI;QAEJ,MAAM;YACJ,CAAC,CAAC,GAAG,CAAA,0BAA0B,CAAC,GAAG;2BAClB,MAAM,kBAAkB,MAAM,MAAM;YACrD,CAAC,CAAC,OACN;+DAEE,YAAY,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAC1B;qBACe,cAAc;iBAClB,WAAW;oBACR,CAAC,CAAa,EAAE,EAAE;YAC5B,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;gBAClB,sBAAsB;gBACtB,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC;gBAC9C,CAAC,CAAC,cAAc,EAAE,CAAC;aACpB;QACH,CAAC;uBACc,CAAC,CAAa,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC;;QAE7D,YAAY;QACZ,YAAY;QACZ,WAAW;QACX,eAAe;QACf,eAAe;QACf,cAAc;;yBAGhB,OAAO;YACL,CAAC,CAAC;gBACE,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;gBAC3B,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAC3D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CACvB;aACF;YACH,CAAC,CAAC,OACN,MAAM,CAAC;IACT,CAAC;IAED,YAAY,CAAC,MAAe;QAC1B,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QAC7C,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;QACvB,IAAI,aAAa,GAAG,GAAG,CAAA,EAAE,CAAC;QAC1B,aAAa,GAAG,GAAG,CAAA,YAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC;;mBAErD,GAAG,EAAE;YACZ,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CACvB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAC9B,mCAAmC,CACpC,CACF,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAC3C,IAAI,MAAM;gBACR,IAAI,CAAC,aAAa,CAChB,aAAa,CAAC;oBACZ,CAAC;oBACD,CAAC;oBACD,OAAO,EAAE,MAAM;oBACf,MAAM,EAAE,MAAO;iBAChB,CAAC,CACH,CAAC;QACN,CAAC;WACA,CAAC;QACR,OAAO,GAAG,CAAA,8BACR,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,UAAU;YAC9C,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC;YAClB,CAAC,CAAC,OACN;eACW,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC;QAClC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QACxB,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CACvD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CACvB;QACC,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,aAAa,CAAC,kBAAkB,CAAE,CAAC;QACtE,aAAa;SACZ,CAAC;IACR,CAAC;IAED,sBAAsB,CAAC,KAAc;QACnC,MAAM,IAAI,GAAG,KAAK,CAAC,aAAa,CAAC,iBAAiB,QAAQ,IAAI,CAAC,CAAC;QAChE,IAAI,CAAC,IAAI;YAAE,OAAO,OAAO,CAAC;QAC1B,MAAM,OAAO,GAAG,EAAyB,CAAC;QAC1C,MAAM,aAAa,GAAG,MAAM,CAAC,OAAO,CAClC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE;YACpE,MAAM,GAAG,GAAG,MAAM,CAAC;YACnB,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC;YAC1D,IAAI,GAAG,CAAC,GAAG,CAAC;gBAAE,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;;gBAC/B,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACzB,OAAO,GAAG,CAAC;QACb,CAAC,EAAE,EAA+B,CAAC,CACpC;aACE,MAAM,CACL,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,EAAE,EAAE,CAChB,QAAQ,CAAC,MAAM,GAAG,CAAC;YACnB,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC;gBACpB,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,CACzD;aACA,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC;QACzD,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAC/B,OAAO,CAAC,IAAI,CAAC,GAAG,CAAA,4BAA4B,CAAC,SAAS,CAAC,eAAe,CAAC,CACxE,CAAC;QACF,MAAM,KAAK,GAAG,EAAyB,CAAC;QACxC,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC,CAAC;QAC3E,MAAM,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACjC,MAAM,UAAU,GAAG,GAAG,CAAC;QACvB,MAAM,aAAa,GACjB,CAAC,IAAI,CAAC,OAAO;YACb,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,UAAU,KAAK,GAAG,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;YAC9D,CAAC,CAAC,KAAK;YACP,CAAC,CAAC,MAAM,CAAC;QACb,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;YACzB,MAAM,MAAM,GAAG,UAAU,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;YACvD,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CACzB,OAAO,CAAC,sBAAsB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAChD,CAAC;YACF,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,OAAO,CAAC,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC9B,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;gBACpD,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBACtD,IAAI,WAAW,GAA0B,OAAO,CAAC;gBACjD,IAAI,cAAc,GAAuC,OAAO,CAAC;gBACjE,IAAI,iBAAiB,GAAuC,OAAO,CAAC;gBACpE,IAAI,MAAM,IAAI,GAAG,EAAE;oBACjB,MAAM,EACJ,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GACZ,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;oBACpB,MAAM,MAAM,GAAU,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;oBACzD,WAAW,GAAG,GAAG,EAAE,CACjB,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,CAAC;oBACtD,cAAc,GAAG,CAAC,EAAE,MAAM,EAAc,EAAE,EAAE;wBAC1C,IAAI,MAAM,KAAK,CAAC;4BAAE,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC,CAAC;oBACnE,CAAC,CAAC;oBACF,iBAAiB,GAAG,CAAC,CAAa,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;iBAC9D;gBACD,IAAI,MAAM,IAAI,IAAI,CAAC,UAAU,KAAK,GAAG,EAAE;oBACrC,IAAI,OAAO,KAAK,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;wBACnE,OAAO;oBACT,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;oBACnB,MAAM,EACJ,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EACb,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,GACd,GAAG,UAAU,CAAC,GAAG,CAAC,aAAc,CAAC,CAAC;oBACnC,MAAM,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC;oBAC3B,MAAM,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC;oBAC3B,IAAI,CAAC,KAAK,CAAC,EAAE;wBACX,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;wBACzC,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;wBACzC,IAAI,EAAE,GAAG,EAAE,EAAE;4BACX,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC;4BACrD,EAAE,GAAG,EAAE,CAAC;yBACT;6BAAM;4BACL,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC;4BACrD,EAAE,GAAG,EAAE,CAAC;yBACT;wBACD,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE;4BACxB,IAAI,EAAE,IAAI,IAAI;gCAAE,EAAE,IAAI,CAAC,CAAC;;gCACnB,EAAE,IAAI,CAAC,CAAC;qBAChB;oBACD,WAAW,GAAG,GAAG,EAAE;wBACjB,IAAI,CAAC,aAAa,CAChB,aAAa,CAAC;4BACZ,MAAM,EAAE,OAAO;4BACf,OAAO,EAAE,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;4BACtC,CAAC,EAAE,EAAE;4BACL,CAAC,EAAE,EAAE;yBACN,CAAC,CACH,CAAC;oBACJ,CAAC,CAAC;oBACF,KAAK,CAAC,IAAI,CAAC,GAAG,CAAA,YAAY,IAAI,CAAC,MAAM,QAAQ,IAAI,CAAC,MAAM;iEACD,aAAa;uBACvD,WAAW,KAAK,CAAC,CAAC;iBAChC;gBACD,IAAI,IAAI,CAAC,UAAU;oBACjB,WAAW,GAAG,GAAG,EAAE;wBACjB,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,UAAW,CAAC;wBACtD,IACE,IAAI;6BACD,OAAO,CAAC,uCAAuC,CAAE;6BACjD,aAAa,CACZ,sBAAsB,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CACzD;4BAEH,OAAO;wBACT,MAAM,CAAC,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;wBACxD,MAAM,QAAQ,GAAG,KAAK,KAAK,KAAK,CAAC;wBAEjC,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;wBACtB,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;wBAEtB,IAAI,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;wBAClC,IAAI,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;wBAElC,MAAM,KAAK,GACT,KAAK,KAAK,EAAE,IAAI,KAAK,KAAK,EAAE;4BAC1B,CAAC,CAAE,CAAC,KAAK,EAAE,KAAK,CAAW;4BAC3B,CAAC,CAAE,CAAC,KAAK,EAAE,KAAK,CAAW,CAAC;wBAEhC,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,gBAAgB,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;wBAEjE,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;wBAC9B,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;wBAE9B,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;wBACvC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;wBACpB,SAAS,CAAC,IAAI,CAAC,CAAC;wBAChB,IAAI,CAAC,aAAa,CAChB,eAAe,CAAC;4BACd,IAAI;4BACJ,YAAY;4BACZ,IAAI;4BACJ,EAAE,EAAE,KAAK;yBACV,CAAC,CACH,CAAC;oBACJ,CAAC,CAAC;gBAEJ,KAAK,CAAC,IAAI,CACR,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE;kCAC3B,aAAa;gCACf,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO;kCACrB,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,MAAM,CAC1D,CAAC;gBACF,KAAK,CAAC,IAAI,CACR,GAAG,CAAA,aAAa,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE;kCAC3B,aAAa,mBAAmB,UAAU;+BAC7C,iBAAiB,eAAe,cAAc;yBACpD,WAAW,cAAc,cAAc,KAAK,CAC5D,CAAC;gBACF,IACE,MAAM;oBACN,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;oBAE/D,KAAK,CAAC,IAAI,CACR,GAAG,CAAA,YAAY,EAAE,GAAG,UAAU,GAAG,CAAC,QAAQ,EAAE,GAAG,UAAU,GAAG,CAAC;2BAC9C,UAAU,aAAa,UAAU;2BACjC,WAAW,cAAc,cAAc;iCACjC,iBAAiB,eAAe,cAAc;oCAC3C,aAAa,kBAAkB,CACxD,CAAC;gBACJ,IACE,MAAM;oBACN,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;oBAEnE,KAAK,CAAC,IAAI,CACR,GAAG,CAAA,YAAY,EAAE,GAAG,UAAU,GAAG,CAAC,QAAQ,EAAE,GAAG,UAAU,GAAG,CAAC;2BAC9C,UAAU,aAAa,UAAU;2BACjC,WAAW,cAAc,cAAc;iCACjC,iBAAiB,eAAe,cAAc;oCAC3C,aAAa,kBAAkB,CACxD,CAAC;gBACJ,CAAC,IAAI,CAAC,CAAC;aACR;QACH,CAAC,CAAC,CAAC;QACH,MAAM,EAAE,GACN,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,IAAI,CAAC,UAAU;YAC7C,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC;YACjB,CAAC,CAAC,OAAO,CAAC;QACd,OAAO,GAAG,CAAA,uBAAuB,EAAE;iBACtB,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC;UACrC,OAAO;UACP,KAAK;WACJ,CAAC;IACV,CAAC;;AAEM,gBAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4ClB,CAAC;AA5pFF;IADC,QAAQ,EAAE;sCACO;AAGlB;IADC,QAAQ,EAAE;6CACU;AAGrB;IADC,QAAQ,EAAE;4CACI;AAGf;IADC,QAAQ,EAAE;2CACG;AAGd;IADC,QAAQ,EAAE;sCACE;AAGb;IADC,QAAQ,EAAE;6CACU;AAGrB;IADC,QAAQ,EAAE;6CACU;AAGrB;IADC,QAAQ,EAAE;0CACO;AAGlB;IADC,QAAQ,EAAE;gDACmB;AAG9B;IADC,QAAQ,EAAE;+CACY;AAGvB;IADC,QAAQ,EAAE;6CAKT;AAGF;IADC,QAAQ,EAAE;6CACU;AAGrB;IADC,KAAK,EAAE;qCASP;AAGD;IADC,KAAK,CAAC,qBAAqB,CAAC;qDACD;AAG5B;IADC,KAAK,CAAC,oBAAoB,CAAC;oDACE;AAG9B;IADC,KAAK,CAAC,qBAAqB,CAAC;qDACE;AAG/B;IADC,KAAK,CAAC,SAAS,CAAC;sCACQ;AAGzB;IADC,KAAK,CAAC,cAAc,CAAC;6CACA;AAGtB;IADC,KAAK,EAAE;yCACG;AAGX;IADC,KAAK,EAAE;yCACG;AAGX;IADC,KAAK,EAAE;0CACI;AAGZ;IADC,KAAK,EAAE;0CACI;AAGZ;IADC,KAAK,EAAE;2CACK;AAGb;IADC,KAAK,EAAE;2CACK;AAGb;IADC,KAAK,EAAE;uCAC+C;AAtF5C,SAAS;IAFrB,aAAa,CAAC,YAAY,CAAC;IAC5B,gEAAgE;GACnD,SAAS,CA+pFrB;SA/pFY,SAAS","sourcesContent":["import { css, html, nothing, LitElement, svg, TemplateResult } from 'lit';\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars */\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { createRef, Ref, ref } from 'lit/directives/ref.js';\n\nimport { Edit, newEditEvent } from '@openscd/open-scd-core';\n\nimport type { Dialog } from '@material/mwc-dialog';\nimport type { SingleSelectedEvent } from '@material/mwc-list';\nimport type { Snackbar } from '@material/mwc-snackbar';\nimport type { TextField } from '@material/mwc-textfield';\n\nimport '@material/mwc-dialog';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item.js';\nimport '@material/mwc-snackbar';\nimport '@material/mwc-textfield';\n\nimport { getReference, identity } from '@openscd/oscd-scl';\nimport {\n  bayGraphic,\n  eqRingPath,\n  equipmentGraphic,\n  movePath,\n  ptrIcon,\n  resizeBRPath,\n  resizePath,\n  resizeTLPath,\n  symbols,\n  voltageLevelGraphic,\n  zigZag2WTransform,\n  zigZagPath,\n} from './icons.js';\nimport {\n  attributes,\n  connectionStartPoints,\n  elementPath,\n  isBusBar,\n  isEqType,\n  newConnectEvent,\n  newPlaceEvent,\n  newPlaceLabelEvent,\n  newResizeEvent,\n  newResizeTLEvent,\n  newRotateEvent,\n  newStartConnectEvent,\n  newStartPlaceEvent,\n  newStartPlaceLabelEvent,\n  newStartResizeBREvent,\n  newStartResizeTLEvent,\n  Point,\n  prettyPrint,\n  privType,\n  removeNode,\n  removeTerminal,\n  ringedEqTypes,\n  robotoDataURL,\n  singleTerminal,\n  sldNs,\n  svgNs,\n  uniqueName,\n  uuid,\n  xlinkNs,\n  xmlBoolean,\n} from './util.js';\n\nconst parentTags: Partial<Record<string, string[]>> = {\n  ConductingEquipment: ['Bay'],\n  Bay: ['VoltageLevel'],\n  VoltageLevel: ['Substation'],\n  PowerTransformer: ['Bay', 'VoltageLevel', 'Substation'],\n};\n\ntype EditWizardDetial = { element: Element };\n\nfunction newEditWizardEvent(element: Element): CustomEvent<EditWizardDetial> {\n  return new CustomEvent<EditWizardDetial>('oscd-edit-wizard-request', {\n    bubbles: true,\n    composed: true,\n    detail: { element },\n  });\n}\n\ntype MenuItem = { handler?: () => void; content: TemplateResult };\n\ntype Rect = [number, number, number, number];\n\nfunction contains([x1, y1, w1, h1]: Rect, [x2, y2, w2, h2]: Rect) {\n  return x1 <= x2 && y1 <= y2 && x1 + w1 >= x2 + w2 && y1 + h1 >= y2 + h2;\n}\n\nfunction overlaps([x1, y1, w1, h1]: Rect, [x2, y2, w2, h2]: Rect) {\n  if (x1 >= x2 + w2 || x2 >= x1 + w1) return false;\n  if (y1 >= y2 + h2 || y2 >= y1 + h1) return false;\n  return true;\n}\n\nfunction containsRect(\n  element: Element,\n  x0: number,\n  y0: number,\n  w0: number,\n  h0: number\n): boolean {\n  const {\n    pos: [x, y],\n    dim: [w, h],\n  } = attributes(element);\n  return contains([x, y, w, h], [x0, y0, w0, h0]);\n}\n\nfunction overlapsRect(\n  element: Element,\n  x0: number,\n  y0: number,\n  w0: number,\n  h0: number\n): boolean {\n  const {\n    pos: [x, y],\n    dim: [w, h],\n  } = attributes(element);\n  return overlaps([x, y, w, h], [x0, y0, w0, h0]);\n}\n\nfunction cleanXML(element: Element) {\n  const cl = element.classList;\n  if (\n    cl.contains('handle') ||\n    cl.contains('preview') ||\n    cl.contains('port') ||\n    (cl.contains('label') && cl.contains('container'))\n  ) {\n    element.remove();\n    return;\n  }\n  if (cl.contains('voltagelevel') || cl.contains('bay'))\n    element.querySelector('rect')?.remove();\n  Array.from(element.childNodes).forEach(child => {\n    if (child.nodeType === 8) element.removeChild(child);\n    if (child.nodeType === 1) cleanXML(child as Element);\n  });\n}\n\nfunction between(a: number, x: number, b: number): boolean {\n  return (a <= x && x <= b) || (b <= x && x <= a);\n}\n\nfunction liesOn([x, y]: Point, [x1, y1]: Point, [x2, y2]: Point): boolean {\n  return (\n    (x === x1 && x === x2 && between(y1, y, y2)) ||\n    (y === y1 && y === y2 && between(x1, x, x2))\n  );\n}\n\nfunction pointsOnLine(p1: Point, p2: Point): Point[] {\n  const points = [] as Point[];\n  const coord = p1[0] === p2[0] ? 1 : 0;\n  let p = p1[coord] < p2[coord] ? p1 : p2;\n  const q = p === p1 ? p2 : p1;\n  p = p.slice() as Point;\n  p[coord] = Math.floor(p[coord] * 2) / 2;\n  while (p[coord] <= q[coord]) {\n    points.push(p);\n    p = p.slice() as Point;\n    p[coord] += 0.5;\n  }\n  return points;\n}\n\nfunction distance([x1, y1]: Point, [x2, y2]: Point): number {\n  return Math.abs(x1 - x2) + Math.abs(y1 - y2);\n}\n\nfunction closestPointOnLine(p: Point, p1: Point, p2: Point): Point {\n  let point = p1;\n  const points = pointsOnLine(p1, p2);\n\n  points.forEach(candidate => {\n    if (distance(candidate, p) < distance(point, p)) point = candidate;\n  });\n\n  return point;\n}\n\nfunction findIntersection(p1: Point, p2: Point, lp1: Point, lp2: Point): Point {\n  if (liesOn(p1, lp1, lp2)) return p1;\n  if (liesOn(lp1, p1, p2)) return lp1;\n  if (liesOn(lp2, p1, p2)) return lp2;\n  return closestPointOnLine(p2, lp1, lp2);\n}\n\nfunction cleanPath(path: Point[]) {\n  let i = path.length - 2;\n  while (i > 0) {\n    const [x, y] = path[i];\n    const [nx, ny] = path[i + 1];\n    const [px, py] = path[i - 1];\n\n    if (\n      (x === nx && y === ny) ||\n      (x === nx && x === px) ||\n      (y === ny && y === py)\n    )\n      path.splice(i, 1);\n    i -= 1;\n  }\n}\n\nfunction isBay(element: Element) {\n  return element.tagName === 'Bay' && !isBusBar(element);\n}\n\nfunction preventDefault(e: MouseEvent) {\n  if (e.button === 1) e.preventDefault();\n}\n\nfunction copy(element: Element, nsp: string): Element {\n  const clone = element.cloneNode(true) as Element;\n  const terminals = new Set<Element>(\n    Array.from(element.querySelectorAll('Terminal, NeutralPoint'))\n  );\n  const cNodes = new Set<Element>(\n    Array.from(element.querySelectorAll('ConnectivityNode'))\n  );\n  terminals.forEach(terminal => {\n    const cNode = element.ownerDocument.querySelector(\n      `ConnectivityNode[pathName=\"${terminal.getAttribute(\n        'connectivityNode'\n      )}\"]`\n    );\n    if (cNode) cNodes.add(cNode);\n  });\n  const foreignCNodes = new Set<Element>();\n  cNodes.forEach(cNode => {\n    const foreignTerminal = Array.from(\n      element.ownerDocument.querySelectorAll(\n        `[connectivityNode=\"${cNode.getAttribute('pathName')}\"]`\n      )\n    ).find(terminal => !terminals.has(terminal));\n    if (\n      foreignTerminal ||\n      (isBusBar(cNode.closest('Bay')!) &&\n        cNode.closest(element.tagName) !== element)\n    )\n      foreignCNodes.add(cNode);\n  });\n  foreignCNodes.forEach(cNode => {\n    if (cNode.closest(element.tagName) === element) {\n      if (isBusBar(cNode.closest('Bay')!))\n        clone\n          .querySelector(\n            `ConnectivityNode[pathName=\"${cNode.getAttribute('pathName')}\"]`\n          )\n          ?.closest('Bay')\n          ?.remove();\n      else\n        clone\n          .querySelector(\n            `ConnectivityNode[pathName=\"${cNode.getAttribute('pathName')}\"]`\n          )\n          ?.remove();\n    }\n    terminals.forEach(terminal => {\n      if (\n        terminal.getAttribute('connectivityNode') ===\n        cNode.getAttribute('pathName')\n      )\n        clone\n          .querySelector(`[*|uuid=\"${terminal.getAttributeNS(sldNs, 'uuid')}\"]`)\n          ?.remove();\n    });\n  });\n  Array.from(clone.querySelectorAll('Terminal, NeutralPoint')).forEach(\n    terminal => {\n      const oldUUID = terminal.getAttributeNS(sldNs, 'uuid');\n      if (!oldUUID) return;\n      const newUUID = uuid();\n      Array.from(clone.querySelectorAll(`Vertex[*|uuid=\"${oldUUID}\"`)).forEach(\n        vertex => vertex.setAttributeNS(sldNs, `${nsp}:uuid`, newUUID)\n      );\n      terminal.setAttributeNS(sldNs, `${nsp}:uuid`, newUUID);\n    }\n  );\n  return clone;\n}\n\nfunction renderMenuHeader(element: Element) {\n  const name = element.getAttribute('name') || element.tagName;\n  let detail: string | null | TemplateResult<1> = element.getAttribute('desc');\n  const type = element.getAttribute('type');\n  if (type) {\n    if (detail) detail = html`${type} &mdash; ${detail}`;\n    else detail = type;\n  }\n  let footerGraphic = equipmentGraphic(null);\n  if (element.tagName === 'PowerTransformer') {\n    const windings = element.querySelectorAll('TransformerWinding').length;\n    const { kind } = attributes(element);\n    if (windings === 3) {\n      footerGraphic = ptrIcon(3, { slot: 'graphic' });\n    } else if (windings === 2) {\n      footerGraphic = ptrIcon(2, { slot: 'graphic', kind });\n    } else {\n      footerGraphic = ptrIcon(1, { slot: 'graphic', kind });\n    }\n  } else if (element.tagName === 'TransformerWinding')\n    footerGraphic = ptrIcon(1, { slot: 'graphic' });\n  else if (element.tagName === 'ConductingEquipment')\n    footerGraphic = equipmentGraphic(type);\n  else if (element.tagName === 'Bay' && isBusBar(element))\n    footerGraphic = html`<mwc-icon slot=\"graphic\">horizontal_rule</mwc-icon>`;\n  else if (element.tagName === 'Bay') footerGraphic = bayGraphic;\n  else if (element.tagName === 'VoltageLevel')\n    footerGraphic = voltageLevelGraphic;\n  else if (element.tagName === 'Text') {\n    footerGraphic = html`<mwc-icon slot=\"graphic\">title</mwc-icon>`;\n    detail = element.textContent;\n  }\n  return html`<mwc-list-item ?twoline=${detail} graphic=\"avatar\" noninteractive>\n    <span>${name}</span>\n    ${detail\n      ? html`<span\n          slot=\"secondary\"\n          style=\"display: inline-block; max-width: 15em; overflow: hidden; text-overflow: ellipsis;\"\n        >\n          ${detail}\n        </span>`\n      : nothing}\n    ${footerGraphic}\n  </mwc-list-item>`;\n}\n\n@customElement('sld-editor')\n/* eslint-disable-next-line @typescript-eslint/no-unused-vars */\nexport class SLDEditor extends LitElement {\n  @property()\n  doc!: XMLDocument;\n\n  @property()\n  substation!: Element;\n\n  @property()\n  editCount = -1;\n\n  @property()\n  gridSize = 32;\n\n  @property()\n  nsp = 'esld';\n\n  @property()\n  resizingBR?: Element;\n\n  @property()\n  resizingTL?: Element;\n\n  @property()\n  placing?: Element;\n\n  @property()\n  placingOffset: Point = [0, 0];\n\n  @property()\n  placingLabel?: Element;\n\n  @property()\n  connecting?: {\n    from: Element;\n    path: Point[];\n    fromTerminal: 'T1' | 'T2' | 'N1' | 'N2';\n  };\n\n  @property()\n  showLabels?: boolean;\n\n  @state()\n  get idle(): boolean {\n    return !(\n      this.placing ||\n      this.resizingBR ||\n      this.resizingTL ||\n      this.placingLabel ||\n      this.connecting\n    );\n  }\n\n  @query('#resizeSubstationUI')\n  resizeSubstationUI!: Dialog;\n\n  @query('#substationWidthUI')\n  substationWidthUI!: TextField;\n\n  @query('#substationHeightUI')\n  substationHeightUI!: TextField;\n\n  @query('svg#sld')\n  sld!: SVGGraphicsElement;\n\n  @query('mwc-snackbar')\n  groundHint!: Snackbar;\n\n  @state()\n  mouseX = 0;\n\n  @state()\n  mouseY = 0;\n\n  @state()\n  mouseX2 = 0;\n\n  @state()\n  mouseY2 = 0;\n\n  @state()\n  mouseX2f = 0;\n\n  @state()\n  mouseY2f = 0;\n\n  @state()\n  menu?: { element: Element; top: number; left: number };\n\n  coordinatesRef: Ref<HTMLElement> = createRef();\n\n  positionCoordinates(e: MouseEvent) {\n    const coordinatesDiv = this.coordinatesRef?.value;\n    if (coordinatesDiv) {\n      coordinatesDiv.style.top = `${e.clientY}px`;\n      coordinatesDiv.style.left = `${e.clientX + 16}px`;\n    }\n  }\n\n  openMenu(element: Element, e: MouseEvent) {\n    if (this.idle) this.menu = { element, left: e.clientX, top: e.clientY };\n    e.preventDefault();\n  }\n\n  svgCoordinates(clientX: number, clientY: number) {\n    const p = new DOMPoint(clientX, clientY);\n    const { x, y } = p.matrixTransform(this.sld.getScreenCTM()!.inverse());\n    return [x, y].map(coord => Math.max(0, coord)) as Point;\n  }\n\n  canPlaceAt(element: Element, x: number, y: number, w: number, h: number) {\n    if (element.tagName === 'Substation') return true;\n\n    const overlappingSibling = Array.from(\n      this.substation.querySelectorAll(`${element.tagName}, PowerTransformer`)\n    ).find(\n      sibling =>\n        sibling.closest(element.tagName) !== element &&\n        overlapsRect(sibling, x, y, w, h) &&\n        !isBusBar(sibling)\n    );\n    if (overlappingSibling && !isBusBar(element)) {\n      return false;\n    }\n\n    const containingParent =\n      element.tagName === 'VoltageLevel' ||\n      element.tagName === 'PowerTransformer'\n        ? containsRect(this.substation, x, y, w, h)\n        : Array.from(\n            this.substation.querySelectorAll(\n              parentTags[element.tagName]!.join(',')\n            )\n          ).find(\n            parent => !isBusBar(parent) && containsRect(parent, x, y, w, h)\n          );\n    if (containingParent) return true;\n    return false;\n  }\n\n  canResizeTo(element: Element, w: number, h: number) {\n    const {\n      pos: [x, y],\n      dim: [oldW, oldH],\n    } = attributes(element);\n\n    if (\n      !this.canPlaceAt(element, x, y, w, h) &&\n      this.canPlaceAt(element, x, y, oldW, oldH)\n    )\n      return false;\n\n    const lostChild = Array.from(element.children).find(child => {\n      if (!parentTags[child.tagName]?.includes(element.tagName)) return false;\n      const {\n        pos: [cx, cy],\n        dim: [cw, ch],\n      } = attributes(child);\n\n      return !contains([x, y, w, h], [cx, cy, cw, ch]);\n    });\n    if (lostChild) return false;\n\n    return true;\n  }\n\n  canResizeToTL(element: Element, x: number, y: number, w: number, h: number) {\n    if (!this.canPlaceAt(element, x, y, w, h)) return false;\n\n    const lostChild = Array.from(element.children).find(child => {\n      if (!parentTags[child.tagName]?.includes(element.tagName)) return false;\n      const {\n        pos: [cx, cy],\n        dim: [cw, ch],\n      } = attributes(child);\n\n      return !contains([x, y, w, h], [cx, cy, cw, ch]);\n    });\n    if (lostChild) return false;\n\n    return true;\n  }\n\n  renderedLabelPosition(element: Element): Point {\n    let {\n      label: [x, y],\n    } = attributes(element);\n    const [offsetX, offsetY] = this.placingOffset;\n    if (\n      this.placing &&\n      element.closest(this.placing.tagName) === this.placing\n    ) {\n      const {\n        pos: [parentX, parentY],\n      } = attributes(this.placing);\n      x += this.mouseX - parentX - offsetX;\n      y += this.mouseY - parentY - offsetY;\n    }\n    if (this.placingLabel === element) {\n      x = this.mouseX2 - 0.5 - offsetX;\n      y = this.mouseY2 + 0.5 - offsetY;\n    }\n    if (this.resizingTL === element) {\n      const {\n        pos: [resX, resY],\n        dim: [resW, resH],\n      } = attributes(element);\n      if (resX === x && resY === y) {\n        x += Math.min(this.mouseX, resX + resW - 1) - resX;\n        y += Math.min(this.mouseY, resY + resH - 1) - resY;\n      }\n    }\n    return [x, y];\n  }\n\n  renderedPosition(element: Element): Point {\n    let {\n      pos: [x, y],\n    } = attributes(element);\n    if (\n      this.placing &&\n      element.closest(this.placing.tagName) === this.placing\n    ) {\n      const {\n        pos: [parentX, parentY],\n      } = attributes(this.placing);\n      const [offsetX, offsetY] = this.placingOffset;\n      x += this.mouseX - parentX - offsetX;\n      y += this.mouseY - parentY - offsetY;\n    }\n    return [x, y];\n  }\n\n  handleKeydown = ({ key }: KeyboardEvent) => {\n    if (key === 'Escape') this.menu = undefined;\n  };\n\n  handleClick = (e: MouseEvent) => {\n    if (\n      this.menu &&\n      !e\n        .composedPath()\n        .find(elm => 'id' in elm && elm.id === 'sld-context-menu')\n    ) {\n      e.stopImmediatePropagation();\n      this.menu = undefined;\n    }\n  };\n\n  connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('keydown', this.handleKeydown);\n    window.addEventListener('click', this.handleClick, true);\n    window.addEventListener('click', this.positionCoordinates);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    window.removeEventListener('keydown', this.handleKeydown);\n    window.removeEventListener('click', this.handleClick);\n    window.removeEventListener('click', this.positionCoordinates);\n  }\n\n  saveSVG() {\n    const sld = this.sld.cloneNode(true) as Element;\n    cleanXML(sld);\n    const blob = new Blob([prettyPrint(sld)], {\n      type: 'application/xml',\n    });\n\n    const a = document.createElement('a');\n    a.download = `${this.substation.getAttribute('name')}.svg`;\n    a.href = URL.createObjectURL(blob);\n    a.dataset.downloadurl = ['application/xml', a.download, a.href].join(':');\n    a.style.display = 'none';\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    setTimeout(() => {\n      URL.revokeObjectURL(a.href);\n    }, 5000);\n  }\n\n  nearestOpenTerminal(equipment?: Element): 'T1' | 'T2' | undefined {\n    if (!equipment) return undefined;\n    const topTerminal = equipment.querySelector('Terminal[name=\"T1\"]');\n    const bottomTerminal = equipment.querySelector('Terminal:not([name=\"T1\"])');\n    const oneSided = singleTerminal.has(equipment.getAttribute('type')!);\n    if (topTerminal && bottomTerminal) return undefined;\n    if (oneSided && (topTerminal || bottomTerminal)) return undefined;\n    if (oneSided) return 'T1';\n    if (topTerminal) return 'T2';\n    if (bottomTerminal) return 'T1';\n\n    const [mx, my] = [this.mouseX2f, this.mouseY2f];\n    const {\n      rot,\n      pos: [x, y],\n    } = attributes(equipment);\n    if (rot === 0 && my >= y + 0.5) return 'T2';\n    if (rot === 1 && mx < x + 0.5) return 'T2';\n    if (rot === 2 && my < y + 0.5) return 'T2';\n    if (rot === 3 && mx >= x + 0.5) return 'T2';\n    return 'T1';\n  }\n\n  groundTerminal(equipment: Element, name: 'T1' | 'T2' | 'N1' | 'N2') {\n    const neutralPoint = name.startsWith('N');\n    const bay = equipment.closest('Bay');\n    if (!bay) {\n      this.groundHint.show();\n      return;\n    }\n    const edits: Edit[] = [];\n    let grounded = bay.querySelector(\n      ':scope > ConnectivityNode[name=\"grounded\"]'\n    );\n    let pathName = grounded?.getAttribute('pathName');\n    if (!pathName) {\n      pathName = elementPath(bay, 'grounded');\n      grounded = this.doc.createElementNS(\n        this.doc.documentElement.namespaceURI,\n        'ConnectivityNode'\n      );\n      grounded.setAttribute('name', 'grounded');\n      grounded.setAttribute('pathName', pathName);\n      edits.push({\n        parent: bay,\n        node: grounded,\n        reference: getReference(bay, 'ConnectivityNode'),\n      });\n    }\n    const tagName = neutralPoint ? 'NeutralPoint' : 'Terminal';\n    const terminal = this.doc.createElementNS(\n      this.doc.documentElement.namespaceURI,\n      tagName\n    );\n    terminal.setAttribute('name', name);\n    terminal.setAttribute('cNodeName', 'grounded');\n    const sName = bay.closest('Substation')!.getAttribute('name');\n    if (sName) terminal.setAttribute('substationName', sName);\n    const vlName = bay.closest('VoltageLevel')!.getAttribute('name');\n    if (vlName) terminal.setAttribute('voltageLevelName', vlName);\n    const bName = bay.getAttribute('name');\n    if (bName) terminal.setAttribute('bayName', bName);\n    terminal.setAttribute('connectivityNode', pathName);\n    edits.push({\n      parent: equipment,\n      node: terminal,\n      reference: getReference(equipment, tagName),\n    });\n    this.dispatchEvent(newEditEvent(edits));\n  }\n\n  flipElement(element: Element) {\n    const { flip, kind } = attributes(element);\n    const edits: Edit[] = [\n      {\n        element,\n        attributes: {\n          [`${this.nsp}:flip`]: {\n            namespaceURI: sldNs,\n            value: flip ? null : 'true',\n          },\n        },\n      },\n    ];\n    if (element.tagName === 'PowerTransformer') {\n      const winding = element.querySelector('TransformerWinding')!;\n      Array.from(winding.querySelectorAll('Terminal')).forEach(terminal =>\n        edits.push(...removeTerminal(terminal))\n      );\n      if (kind === 'earthing') {\n        Array.from(winding.querySelectorAll('NeutralPoint')).forEach(np =>\n          edits.push(...removeTerminal(np))\n        );\n      }\n    }\n    this.dispatchEvent(newEditEvent(edits));\n  }\n\n  addTextTo(element: Element) {\n    const {\n      pos: [x, y],\n    } = attributes(element);\n    const text = this.doc.createElementNS(\n      this.doc.documentElement.namespaceURI,\n      'Text'\n    );\n    text.setAttributeNS(sldNs, `${this.nsp}:lx`, x.toString());\n    text.setAttributeNS(\n      sldNs,\n      `${this.nsp}:ly`,\n      (y < 2 ? y + 1 : y - 1).toString()\n    );\n    this.dispatchEvent(\n      newEditEvent({\n        node: text,\n        parent: element,\n        reference: getReference(element, 'Text'),\n      })\n    );\n  }\n\n  transformerWindingMenuItems(winding: Element) {\n    const tapChanger = winding.querySelector('TapChanger');\n\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit${tapChanger ? ' Winding' : nothing}</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(winding)),\n      },\n    ];\n\n    if (tapChanger)\n      items.unshift(\n        {\n          handler: () => this.dispatchEvent(newEditEvent({ node: tapChanger })),\n          content: html`<mwc-list-item graphic=\"icon\">\n            <span>Remove Tap Changer</span>\n            <mwc-icon slot=\"graphic\">remove</mwc-icon>\n          </mwc-list-item>`,\n        },\n        {\n          content: html`<mwc-list-item graphic=\"icon\">\n            <span>Edit Tap Changer</span>\n            <mwc-icon slot=\"graphic\">edit</mwc-icon>\n          </mwc-list-item>`,\n          handler: () => this.dispatchEvent(newEditWizardEvent(tapChanger)),\n        }\n      );\n    else\n      items.unshift({\n        handler: () => {\n          const node = this.doc.createElementNS(\n            this.doc.documentElement.namespaceURI,\n            'TapChanger'\n          );\n          node.setAttribute('name', 'LTC');\n          node.setAttribute('type', 'LTC');\n          node.setAttribute('name', uniqueName(node, winding));\n          this.dispatchEvent(\n            newEditEvent({\n              parent: winding,\n              node,\n              reference: getReference(winding, 'TapChanger'),\n            })\n          );\n        },\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Add Tap Changer</span>\n          <mwc-icon slot=\"graphic\">north_east</mwc-icon>\n        </mwc-list-item>`,\n      });\n\n    const neutralPoints = Array.from(winding.querySelectorAll('NeutralPoint'));\n\n    if (neutralPoints.length)\n      items.unshift({\n        handler: () =>\n          this.dispatchEvent(\n            newEditEvent(\n              neutralPoints.map(neutralPoint => removeTerminal(neutralPoint))\n            )\n          ),\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Detach Neutral Point</span>\n          <mwc-icon slot=\"graphic\">remove_circle_outline</mwc-icon>\n        </mwc-list-item>`,\n      });\n\n    const terminals = Array.from(winding.querySelectorAll('Terminal'));\n    if (terminals.length)\n      items.unshift({\n        handler: () =>\n          this.dispatchEvent(\n            newEditEvent(terminals.map(terminal => removeTerminal(terminal)))\n          ),\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Detach Terminal${terminals.length > 1 ? 's' : nothing}</span>\n          <mwc-icon slot=\"graphic\">cancel</mwc-icon>\n        </mwc-list-item>`,\n      });\n\n    return items;\n  }\n\n  transformerMenuItems(transformer: Element) {\n    const text = transformer.querySelector(':scope > Text');\n    const {\n      pos: [x, y],\n    } = attributes(transformer);\n    const offset: Point = [this.mouseX - x, this.mouseY - y];\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Rotate</span>\n          <mwc-icon slot=\"graphic\">rotate_90_degrees_cw</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(newRotateEvent(transformer));\n        },\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Copy</span>\n          <mwc-icon slot=\"graphic\">copy_all</mwc-icon>\n        </mwc-list-item>`,\n        handler: () =>\n          this.dispatchEvent(\n            newStartPlaceEvent(copy(transformer, this.nsp), offset)\n          ),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () =>\n          this.dispatchEvent(newStartPlaceEvent(transformer, offset)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(transformer)),\n      },\n      text\n        ? {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Delete Text</span>\n              <mwc-icon slot=\"graphic\">format_strikethrough</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.dispatchEvent(newEditEvent({ node: text })),\n          }\n        : {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Add Text</span>\n              <mwc-icon slot=\"graphic\">title</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.addTextTo(transformer),\n          },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(transformer)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const edits: Edit[] = [];\n          Array.from(\n            transformer.querySelectorAll('Terminal, NeutralPoint')\n          ).forEach(terminal => edits.push(...removeTerminal(terminal)));\n          edits.push({ node: transformer });\n          this.dispatchEvent(newEditEvent(edits));\n        },\n      },\n    ];\n\n    const kind = transformer.getAttributeNS(sldNs, 'kind');\n    const windingCount =\n      transformer.querySelectorAll('TransformerWinding').length;\n\n    if (kind === 'auto' || (kind === 'earthing' && windingCount === 2))\n      items.unshift({\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Mirror</span>\n          <mwc-icon slot=\"graphic\">flip</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.flipElement(transformer),\n      });\n\n    return items;\n  }\n\n  equipmentMenuItems(equipment: Element) {\n    const textElement = equipment.querySelector(':scope > Text');\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Mirror</span>\n          <mwc-icon slot=\"graphic\">flip</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.flipElement(equipment),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Rotate</span>\n          <mwc-icon slot=\"graphic\">rotate_90_degrees_cw</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(newRotateEvent(equipment));\n        },\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Copy</span>\n          <mwc-icon slot=\"graphic\">copy_all</mwc-icon>\n        </mwc-list-item>`,\n        handler: () =>\n          this.dispatchEvent(newStartPlaceEvent(copy(equipment, this.nsp))),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceEvent(equipment)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(equipment)),\n      },\n      textElement\n        ? {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Remove Text</span>\n              <mwc-icon slot=\"graphic\">format_strikethrough</mwc-icon>\n            </mwc-list-item>`,\n            handler: () =>\n              this.dispatchEvent(newEditEvent({ node: textElement })),\n          }\n        : {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Add Text</span>\n              <mwc-icon slot=\"graphic\">title</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.addTextTo(equipment),\n          },\n\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(equipment)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const edits: Edit[] = [];\n          Array.from(equipment.querySelectorAll('Terminal')).forEach(terminal =>\n            edits.push(...removeTerminal(terminal))\n          );\n          edits.push({ node: equipment });\n          this.dispatchEvent(newEditEvent(edits));\n        },\n      },\n    ];\n\n    const { rot } = attributes(equipment);\n    const icons = {\n      connect: ['north', 'east', 'south', 'west'],\n      ground: ['expand_less', 'chevron_right', 'expand_more', 'chevron_left'],\n      disconnect: [\n        'arrow_drop_up',\n        'arrow_right',\n        'arrow_drop_down',\n        'arrow_left',\n      ],\n    };\n    const texts = {\n      connect: [\n        'Connect top',\n        'Connect right',\n        'Connect bottom',\n        'Connect left',\n      ],\n      ground: ['Ground top', 'Ground right', 'Ground bottom', 'Ground left'],\n      disconnect: [\n        'Detach top',\n        'Detach right',\n        'Detach bottom',\n        'Detach left',\n      ],\n    };\n    const icon = (kind: 'connect' | 'ground' | 'disconnect', top: boolean) =>\n      icons[kind][top ? rot % 4 : (rot + 2) % 4];\n    const text = (kind: 'connect' | 'ground' | 'disconnect', top: boolean) =>\n      texts[kind][top ? rot % 4 : (rot + 2) % 4];\n    const item = (kind: 'connect' | 'ground' | 'disconnect', top: boolean) =>\n      html`<mwc-list-item graphic=\"icon\">\n        <span>${text(kind, top)}</span>\n        <mwc-icon slot=\"graphic\">${icon(kind, top)}</mwc-icon>\n      </mwc-list-item>`;\n\n    const topTerminal = equipment.querySelector('Terminal[name=\"T1\"]');\n    const bottomTerminal = equipment.querySelector('Terminal:not([name=\"T1\"])');\n\n    if (bottomTerminal)\n      items.unshift({\n        handler: () =>\n          this.dispatchEvent(newEditEvent(removeTerminal(bottomTerminal))),\n        content: item('disconnect', false),\n      });\n    else if (!singleTerminal.has(equipment.getAttribute('type')!)) {\n      items.unshift(\n        {\n          handler: () =>\n            this.dispatchEvent(\n              newStartConnectEvent({\n                from: equipment,\n                fromTerminal: 'T2',\n                path: connectionStartPoints(equipment).T2,\n              })\n            ),\n          content: item('connect', false),\n        },\n        {\n          handler: () => this.groundTerminal(equipment, 'T2'),\n          content: item('ground', false),\n        }\n      );\n    }\n    if (topTerminal)\n      items.unshift({\n        handler: () =>\n          this.dispatchEvent(newEditEvent(removeTerminal(topTerminal))),\n        content: item('disconnect', true),\n      });\n    else\n      items.unshift(\n        {\n          handler: () =>\n            this.dispatchEvent(\n              newStartConnectEvent({\n                from: equipment,\n                fromTerminal: 'T1',\n                path: connectionStartPoints(equipment).T1,\n              })\n            ),\n          content: item('connect', true),\n        },\n        {\n          handler: () => this.groundTerminal(equipment, 'T1'),\n          content: item('ground', true),\n        }\n      );\n    return items;\n  }\n\n  busBarMenuItems(busBar: Element) {\n    const text = busBar.querySelector(':scope > Text');\n    const {\n      pos: [x, y],\n    } = attributes(busBar);\n    const offset: Point = [this.mouseX - x, this.mouseY - y];\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Resize</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            slot=\"graphic\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${resizeBRPath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartResizeBREvent(busBar)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceEvent(busBar, offset)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(busBar)),\n      },\n      text\n        ? {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Remove Text</span>\n              <mwc-icon slot=\"graphic\">format_strikethrough</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.dispatchEvent(newEditEvent({ node: text })),\n          }\n        : {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Add Text</span>\n              <mwc-icon slot=\"graphic\">title</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.addTextTo(busBar),\n          },\n\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(busBar)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const node = busBar.querySelector('ConnectivityNode')!;\n          this.dispatchEvent(\n            newEditEvent([...removeNode(node), { node: busBar }])\n          );\n        },\n      },\n    ];\n    return items;\n  }\n\n  containerMenuItems(bayOrVL: Element) {\n    const text = bayOrVL.querySelector(':scope > Text');\n    const {\n      pos: [x, y],\n    } = attributes(bayOrVL);\n    const offset: Point = [this.mouseX - x, this.mouseY - y];\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Resize</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            slot=\"graphic\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${resizeBRPath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartResizeBREvent(bayOrVL)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Copy</span>\n          <mwc-icon slot=\"graphic\">copy_all</mwc-icon>\n        </mwc-list-item>`,\n        handler: () =>\n          this.dispatchEvent(\n            newStartPlaceEvent(copy(bayOrVL, this.nsp), offset)\n          ),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceEvent(bayOrVL, offset)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move Label</span>\n          <mwc-icon slot=\"graphic\">text_rotation_none</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(bayOrVL)),\n      },\n      text\n        ? {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Remove Text</span>\n              <mwc-icon slot=\"graphic\">format_strikethrough</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.dispatchEvent(newEditEvent({ node: text })),\n          }\n        : {\n            content: html`<mwc-list-item graphic=\"icon\">\n              <span>Add Text</span>\n              <mwc-icon slot=\"graphic\">title</mwc-icon>\n            </mwc-list-item>`,\n            handler: () => this.addTextTo(bayOrVL),\n          },\n\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(bayOrVL)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          const edits: Edit[] = [];\n          Array.from(bayOrVL.getElementsByTagName('ConnectivityNode')).forEach(\n            cNode => {\n              if (\n                Array.from(\n                  this.doc.querySelectorAll(\n                    `[connectivityNode=\"${cNode.getAttribute('pathName')}\"]`\n                  )\n                ).find(\n                  terminal => terminal.closest(bayOrVL.tagName) !== bayOrVL\n                )\n              )\n                edits.push(...removeNode(cNode));\n            }\n          );\n          Array.from(\n            bayOrVL.querySelectorAll('Terminal, NeutralPoint')\n          ).forEach(terminal => {\n            const cNode = this.doc.querySelector(\n              `ConnectivityNode[pathName=\"${terminal.getAttribute(\n                'connectivityNode'\n              )}\"]`\n            );\n            if (cNode && cNode.closest(bayOrVL.tagName) !== bayOrVL)\n              edits.push(...removeNode(cNode));\n          });\n          edits.push({ node: bayOrVL });\n          this.dispatchEvent(newEditEvent(edits));\n        },\n      },\n    ];\n    return items;\n  }\n\n  textMenuItems(text: Element) {\n    const { weight, color } = attributes(text);\n    const items: MenuItem[] = [\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Rotate</span>\n          <mwc-icon slot=\"graphic\">rotate_90_degrees_cw</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(newRotateEvent(text));\n        },\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Move</span>\n          <svg\n            xmlns=\"${svgNs}\"\n            height=\"24\"\n            width=\"24\"\n            slot=\"graphic\"\n            viewBox=\"0 96 960 960\"\n          >\n            ${movePath}\n          </svg>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newStartPlaceLabelEvent(text)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Edit</span>\n          <mwc-icon slot=\"graphic\">edit</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => this.dispatchEvent(newEditWizardEvent(text)),\n      },\n      {\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Delete</span>\n          <mwc-icon slot=\"graphic\">delete</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(newEditEvent({ node: text }));\n        },\n      },\n    ];\n\n    if (weight !== 500)\n      items.unshift({\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Bold</span>\n          <mwc-icon slot=\"graphic\">format_bold</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(\n            newEditEvent({\n              element: text,\n              attributes: {\n                [`${this.nsp}:weight`]: { namespaceURI: sldNs, value: '500' },\n              },\n            })\n          );\n        },\n      });\n\n    if (weight !== 300)\n      items.unshift({\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Remove Formatting</span>\n          <mwc-icon slot=\"graphic\">format_clear</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(\n            newEditEvent({\n              element: text,\n              attributes: {\n                [`${this.nsp}:weight`]: { namespaceURI: sldNs, value: null },\n              },\n            })\n          );\n        },\n      });\n\n    if (color.toUpperCase() !== '#BB1326')\n      items.unshift({\n        content: html`<mwc-list-item\n          graphic=\"icon\"\n          style=\"--mdc-theme-text-primary-on-background: #BB1326; --mdc-theme-text-icon-on-background: #BB1326;\"\n        >\n          <span>Red</span>\n          <mwc-icon slot=\"graphic\">format_color_text</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(\n            newEditEvent({\n              element: text,\n              attributes: {\n                [`${this.nsp}:color`]: {\n                  namespaceURI: sldNs,\n                  value: '#BB1326',\n                },\n              },\n            })\n          );\n        },\n      });\n\n    if (color.toUpperCase() !== '#12579B')\n      items.unshift({\n        content: html`<mwc-list-item\n          graphic=\"icon\"\n          style=\"--mdc-theme-text-primary-on-background: #12579B; --mdc-theme-text-icon-on-background: #12579B;\"\n        >\n          <span>Blue</span>\n          <mwc-icon slot=\"graphic\">format_color_text</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(\n            newEditEvent({\n              element: text,\n              attributes: {\n                [`${this.nsp}:color`]: {\n                  namespaceURI: sldNs,\n                  value: '#12579B',\n                },\n              },\n            })\n          );\n        },\n      });\n\n    if (color !== '#000')\n      items.unshift({\n        content: html`<mwc-list-item graphic=\"icon\">\n          <span>Reset Color</span>\n          <mwc-icon slot=\"graphic\">format_color_reset</mwc-icon>\n        </mwc-list-item>`,\n        handler: () => {\n          this.dispatchEvent(\n            newEditEvent({\n              element: text,\n              attributes: {\n                [`${this.nsp}:color`]: {\n                  namespaceURI: sldNs,\n                  value: null,\n                },\n              },\n            })\n          );\n        },\n      });\n\n    return items;\n  }\n\n  renderMenu() {\n    if (!this.menu) return html``;\n    const { element } = this.menu;\n\n    const items: MenuItem[] = [\n      { content: renderMenuHeader(element) },\n      { content: html`<li divider role=\"separator\"></li>` },\n    ];\n    if (element.tagName === 'ConductingEquipment')\n      items.push(...this.equipmentMenuItems(element));\n    else if (element.tagName === 'PowerTransformer')\n      items.push(...this.transformerMenuItems(element));\n    else if (element.tagName === 'Bay' && isBusBar(element))\n      items.push(...this.busBarMenuItems(element));\n    else if (element.tagName === 'Bay' || element.tagName === 'VoltageLevel')\n      items.push(...this.containerMenuItems(element));\n    else if (element.tagName === 'TransformerWinding') {\n      items.push(...this.transformerWindingMenuItems(element));\n      const transformer = element.parentElement!;\n      items.push({ content: html`<li divider role=\"separator\"></li>` });\n      items.push({ content: renderMenuHeader(transformer) });\n      items.push({ content: html`<li divider role=\"separator\"></li>` });\n      items.push(...this.transformerMenuItems(transformer));\n    } else if (element.tagName === 'Text') {\n      items.push(...this.textMenuItems(element));\n      items.push({ content: html`<li divider role=\"separator\"></li>` });\n      items.push({\n        content: renderMenuHeader(element.parentElement!),\n      });\n    }\n\n    const headerHeight =\n      element.hasAttribute('desc') ||\n      element.hasAttribute('type') ||\n      (element.tagName === 'Text' && element.textContent)\n        ? 73\n        : 57;\n\n    return html`\n      <menu\n        id=\"sld-context-menu\"\n        style=\"top: ${this.menu.top - headerHeight}px; left: ${this.menu\n          .left}px;\"\n        ${ref(async (menu?: Element) => {\n          if (!(menu instanceof HTMLElement)) return;\n          await this.updateComplete;\n          const { bottom, right } = menu.getBoundingClientRect();\n          if (bottom > window.innerHeight) {\n            menu.style.removeProperty('top');\n            // eslint-disable-next-line no-param-reassign\n            menu.style.bottom = `0px`;\n            // eslint-disable-next-line no-param-reassign\n            menu.style.maxHeight = `calc(100vh - 68px)`;\n          }\n          if (right > window.innerWidth) {\n            menu.style.removeProperty('left');\n            // eslint-disable-next-line no-param-reassign\n            menu.style.right = '0px';\n          }\n        })}\n      >\n        <mwc-list\n          @selected=${({ detail: { index } }: SingleSelectedEvent) => {\n            items.filter(item => item.handler)[index]?.handler?.();\n            this.menu = undefined;\n          }}\n        >\n          ${items.map(i => i.content)}\n        </mwc-list>\n      </menu>\n    `;\n  }\n\n  render() {\n    const {\n      dim: [w, h],\n    } = attributes(this.substation);\n\n    const placingTarget =\n      this.placing?.tagName === 'VoltageLevel'\n        ? svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />`\n        : nothing;\n\n    const transformerPlacingTarget =\n      this.placing?.tagName === 'PowerTransformer'\n        ? svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />`\n        : nothing;\n\n    const placingLabelTarget = this.placingLabel\n      ? svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#halfgrid)\"\n      @click=${() => {\n        const element = this.placingLabel!;\n        const [x, y] = this.renderedLabelPosition(element);\n        this.dispatchEvent(newPlaceLabelEvent({ element, x, y }));\n      }}\n      />`\n      : nothing;\n\n    let placingElement = svg``;\n    if (this.placing) {\n      if (this.placing.tagName === 'VoltageLevel' || isBay(this.placing))\n        placingElement = this.renderContainer(this.placing, true);\n      else if (this.placing.tagName === 'ConductingEquipment')\n        placingElement = this.renderEquipment(this.placing, { preview: true });\n      else if (this.placing.tagName === 'PowerTransformer')\n        placingElement = this.renderPowerTransformer(this.placing, true);\n      else if (isBusBar(this.placing))\n        placingElement = this.renderBusBar(this.placing);\n    }\n\n    let coordinates = html``;\n    let invalid = false;\n    let hidden = true;\n\n    if (this.placing) {\n      const {\n        dim: [w0, h0],\n      } = attributes(this.placing);\n      hidden = false;\n      const [offsetX, offsetY] = this.placingOffset;\n      const x = this.mouseX - offsetX;\n      const y = this.mouseY - offsetY;\n      invalid = !this.canPlaceAt(this.placing, x, y, w0, h0);\n      coordinates = html`${x},${y}`;\n    }\n\n    if (this.resizingBR && !isBusBar(this.resizingBR)) {\n      const {\n        pos: [x, y],\n      } = attributes(this.resizingBR);\n      const newW = Math.max(1, this.mouseX - x + 1);\n      const newH = Math.max(1, this.mouseY - y + 1);\n      hidden = false;\n      invalid = !this.canResizeTo(this.resizingBR, newW, newH);\n      coordinates = html`${newW}&times;${newH}`;\n    }\n\n    if (this.resizingTL) {\n      const {\n        pos: [x, y],\n        dim: [resW, resH],\n      } = attributes(this.resizingTL);\n      const newW = Math.max(1, x + resW - this.mouseX);\n      const newH = Math.max(1, y + resH - this.mouseY);\n      const newX = Math.min(this.mouseX, x + resH - 1);\n      const newY = Math.min(this.mouseY, y + resW - 1);\n      hidden = false;\n      invalid = !this.canResizeToTL(this.resizingTL, newX, newY, newW, newH);\n      coordinates = html`${newW}&times;${newH}`;\n    }\n\n    const coordinateTooltip = html`<div\n      ${ref(this.coordinatesRef)}\n      class=\"${classMap({ coordinates: true, invalid, hidden })}\"\n    >\n      (${coordinates})\n    </div>`;\n\n    const connectionPreview = [];\n    if (this.connecting?.from.closest('Substation') === this.substation) {\n      const { from, path, fromTerminal } = this.connecting;\n      let i = 0;\n      while (i < path.length - 2) {\n        const [x1, y1] = path[i];\n        const [x2, y2] = path[i + 1];\n        connectionPreview.push(\n          svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`\n        );\n        i += 1;\n      }\n\n      const [[x1, y1], [oldX2, oldY2]] = path.slice(-2);\n      const vertical = x1 === oldX2;\n\n      let x3 = this.mouseX2;\n      let y3 = this.mouseY2;\n\n      let [x4, y4] = [x3, y3];\n\n      const targetEq = Array.from(\n        this.substation.querySelectorAll('ConductingEquipment')\n      )\n        .filter(eq => eq !== from)\n        .find(eq => {\n          const {\n            pos: [x, y],\n          } = attributes(eq);\n          return x === this.mouseX && y === this.mouseY;\n        });\n\n      const toTerminal = this.nearestOpenTerminal(targetEq);\n\n      if (targetEq && toTerminal) {\n        const [close, far] = connectionStartPoints(targetEq)[toTerminal];\n        [x3, y3] = far;\n        [x4, y4] = close;\n      }\n\n      const x2 = vertical ? oldX2 : x3;\n      const y2 = vertical ? y3 : oldY2;\n\n      connectionPreview.push(\n        svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`,\n        svg`<line x1=\"${x2}\" y1=\"${y2}\" x2=\"${x3}\" y2=\"${y3}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`,\n        svg`<line x1=\"${x3}\" y1=\"${y3}\" x2=\"${x4}\" y2=\"${y4}\"\n                stroke-linecap=\"square\" stroke=\"black\" />`\n      );\n      connectionPreview.push(\n        svg`<rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\"\n      @click=${() => {\n        path[path.length - 1] = [x2, y2];\n        path.push([x3, y3]);\n        path.push([x4, y4]);\n        cleanPath(path);\n        this.requestUpdate();\n        if (targetEq && toTerminal)\n          this.dispatchEvent(\n            newConnectEvent({\n              from,\n              fromTerminal,\n              path,\n              to: targetEq,\n              toTerminal,\n            })\n          );\n      }} />`\n      );\n    }\n\n    const menu = this.renderMenu();\n\n    return html`<section>\n      <h2>\n        ${this.substation.getAttribute('name')}\n        <mwc-icon-button\n          label=\"Edit Substation\"\n          title=\"Edit Substation\"\n          @click=${() =>\n            this.dispatchEvent(newEditWizardEvent(this.substation))}\n          icon=\"edit\"\n        >\n        </mwc-icon-button>\n        <mwc-icon-button\n          label=\"Resize Substation\"\n          title=\"Resize Substation\"\n          @click=${() => this.resizeSubstationUI.show()}\n        >\n          <svg\n            xmlns=\"${svgNs}\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 96 960 960\"\n            opacity=\"0.83\"\n          >\n            ${resizePath}\n          </svg>\n        </mwc-icon-button>\n        <mwc-icon-button\n          label=\"Delete Substation\"\n          title=\"Delete Substation\"\n          @click=${() =>\n            this.dispatchEvent(newEditEvent({ node: this.substation }))}\n          icon=\"delete\"\n        >\n        </mwc-icon-button>\n        <mwc-icon-button\n          label=\"Export Single Line Diagram SVG\"\n          title=\"Export Single Line Diagram SVG\"\n          @click=${() => this.saveSVG()}\n          icon=\"file_download\"\n        >\n        </mwc-icon-button>\n      </h2>\n      <svg\n        xmlns=\"${svgNs}\"\n        xmlns:xlink=\"${xlinkNs}\"\n        id=\"sld\"\n        viewBox=\"0 0 ${w} ${h}\"\n        width=\"${w * this.gridSize}\"\n        height=\"${h * this.gridSize}\"\n        stroke-width=\"0.06\"\n        fill=\"none\"\n        @mousemove=${(e: MouseEvent) => {\n          const [x, y] = this.svgCoordinates(e.clientX, e.clientY);\n          this.mouseX = Math.floor(x);\n          this.mouseY = Math.floor(y);\n          this.mouseX2 = Math.round(x * 2) / 2;\n          this.mouseY2 = Math.round(y * 2) / 2;\n          this.mouseX2f = Math.floor(x * 2) / 2;\n          this.mouseY2f = Math.floor(y * 2) / 2;\n          this.positionCoordinates(e);\n        }}\n      >\n        <style>\n          @font-face {\n            font-family: 'Roboto';\n            font-style: normal;\n            font-weight: 400;\n            src: url(${robotoDataURL}) format('woff');\n          }\n          .handle {\n            visibility: hidden;\n          }\n          :focus {\n            outline: none;\n          }\n          g:hover > .handle {\n            opacity: 0.2;\n            visibility: visible;\n          }\n          g:hover > .handle:hover {\n            visibility: visible;\n            opacity: 0.83;\n          }\n          g.voltagelevel > rect,\n          g.bay > rect {\n            shape-rendering: crispEdges;\n          }\n          svg:not(:hover) .preview {\n            visibility: hidden;\n          }\n          .preview {\n            opacity: 0.75;\n          }\n        </style>\n        ${symbols}\n        <rect width=\"100%\" height=\"100%\" fill=\"white\" />\n        ${placingTarget}\n        ${Array.from(this.substation.children)\n          .filter(child => child.tagName === 'VoltageLevel')\n          .map(vl => svg`${this.renderContainer(vl)}`)}\n        ${connectionPreview}\n        ${this.connecting?.from.closest('Substation') === this.substation\n          ? Array.from(\n              this.substation.querySelectorAll('ConductingEquipment')\n            ).map(eq => this.renderEquipment(eq, { connect: true }))\n          : nothing}\n        ${Array.from(this.substation.querySelectorAll('ConnectivityNode'))\n          .filter(\n            node =>\n              node.getAttribute('name') !== 'grounded' &&\n              !(\n                this.placing &&\n                node.closest(this.placing.tagName) === this.placing\n              ) &&\n              !isBusBar(node.parentElement!)\n          )\n          .map(cNode => this.renderConnectivityNode(cNode))}\n        ${Array.from(this.substation.querySelectorAll('ConnectivityNode'))\n          .filter(\n            node =>\n              node.getAttribute('name') !== 'grounded' &&\n              !(\n                this.placing &&\n                node.closest(this.placing.tagName) === this.placing\n              ) &&\n              isBusBar(node.parentElement!)\n          )\n          .map(cNode => this.renderConnectivityNode(cNode))}\n        ${Array.from(\n          this.substation.querySelectorAll(':scope > PowerTransformer')\n        ).map(transformer => this.renderPowerTransformer(transformer))}\n        ${Array.from(\n          this.substation.querySelectorAll(\n            'VoltageLevel, Bay, ConductingEquipment, PowerTransformer, Text'\n          )\n        )\n          .filter(\n            e =>\n              !this.placing || e.closest(this.placing.tagName) !== this.placing\n          )\n          .map(element => this.renderLabel(element))}\n        ${transformerPlacingTarget} ${placingLabelTarget} ${placingElement}\n      </svg>\n      ${menu} ${coordinateTooltip}\n      <mwc-dialog\n        id=\"resizeSubstationUI\"\n        heading=\"Resize ${this.substation.getAttribute('name')}\"\n      >\n        <div style=\"display: flex; flex-direction: column; gap: 12px;\">\n          <mwc-textfield\n            id=\"substationWidthUI\"\n            type=\"number\"\n            min=\"1\"\n            step=\"1\"\n            label=\"Width\"\n            value=\"${w}\"\n            dialogInitialFocus\n            autoValidate\n            .validityTransform=${(value: string, validity: ValidityState) => {\n              const {\n                dim: [_w, oldH],\n              } = attributes(this.substation);\n              if (\n                validity.valid &&\n                !this.canResizeTo(this.substation, parseInt(value, 10), oldH)\n              ) {\n                return { valid: false, rangeUnderflow: true };\n              }\n              return {};\n            }}\n          ></mwc-textfield>\n          <mwc-textfield\n            id=\"substationHeightUI\"\n            type=\"number\"\n            min=\"1\"\n            step=\"1\"\n            label=\"Height\"\n            value=\"${h}\"\n            autoValidate\n            .validityTransform=${(value: string, validity: ValidityState) => {\n              const {\n                dim: [oldW, _h],\n              } = attributes(this.substation);\n              if (\n                validity.valid &&\n                !this.canResizeTo(this.substation, oldW, parseInt(value, 10))\n              ) {\n                return { valid: false, rangeUnderflow: true };\n              }\n              return {};\n            }}\n          ></mwc-textfield>\n        </div>\n        <mwc-button\n          slot=\"primaryAction\"\n          @click=${() => {\n            const valid = Array.from(\n              this.resizeSubstationUI.querySelectorAll('mwc-textfield')\n            ).every(textField => textField.checkValidity());\n            if (!valid) return;\n            const {\n              dim: [oldW, oldH],\n            } = attributes(this.substation);\n            const [newW, newH] = [\n              this.substationWidthUI,\n              this.substationHeightUI,\n            ].map(ui => parseInt(ui.value ?? '1', 10).toString());\n            this.resizeSubstationUI.close();\n            if (newW === oldW.toString() && newH === oldH.toString()) return;\n            this.dispatchEvent(\n              newEditEvent({\n                element: this.substation,\n                attributes: {\n                  [`${this.nsp}:w`]: { namespaceURI: sldNs, value: newW },\n                  [`${this.nsp}:h`]: { namespaceURI: sldNs, value: newH },\n                },\n              })\n            );\n          }}\n          >resize</mwc-button\n        >\n        <mwc-button dialogAction=\"close\" slot=\"secondaryAction\"\n          >cancel</mwc-button\n        >\n      </mwc-dialog>\n      <mwc-snackbar\n        labelText=\"Only transformers within a bay may be grounded directly.\"\n      >\n        <mwc-icon-button icon=\"close\" slot=\"dismiss\"></mwc-icon-button>\n      </mwc-snackbar>\n    </section>`;\n  }\n\n  renderLabel(element: Element) {\n    if (!this.showLabels) return nothing;\n\n    let deg = 0;\n    let text: string | null | TemplateResult<2>[] =\n      element.getAttribute('name');\n    let weight = 400;\n    let color = 'black';\n    const [x, y] = this.renderedLabelPosition(element);\n\n    if (element.tagName === 'Text') {\n      ({ weight, color } = attributes(element));\n      deg = attributes(element).rot * 90;\n      if (element.textContent)\n        text = element.textContent?.split(/\\r?\\n/).map(\n          (line, i) =>\n            svg`<tspan alignment-baseline=\"central\"\n                  x=\"${x + 0.1}\" dy=\"${i === 0 ? nothing : '1.19em'}\"\n                  visibility=\"${line ? nothing : 'hidden'}\">\n                  ${line || '.'}\n                </tspan>`\n        );\n      else {\n        text = '<Middle click to edit>';\n        color = '#aaa';\n        weight = 500;\n      }\n    }\n\n    const fontSize = element.tagName === 'ConductingEquipment' ? 0.45 : 0.6;\n    let events = 'none';\n    let handleClick: (() => void) | symbol = nothing;\n    if (this.idle) {\n      events = 'all';\n      const offset = [this.mouseX2 - x - 0.5, this.mouseY2 - y + 0.5] as Point;\n      handleClick = () =>\n        this.dispatchEvent(newStartPlaceLabelEvent(element, offset));\n    }\n    const id =\n      element.closest('Substation') === this.substation &&\n      element.tagName !== 'Text'\n        ? identity(element)\n        : nothing;\n    const classes = classMap({\n      label: true,\n      container:\n        (element.tagName === 'Bay' && !isBusBar(element)) ||\n        element.tagName === 'VoltageLevel',\n    });\n    return svg`<g class=\"${classes}\" id=\"label:${id}\"\n                 transform=\"rotate(${deg} ${x + 0.5} ${y - 0.5})\">\n        <text x=\"${x + 0.1}\" y=\"${y - 0.5}\"\n          alignment-baseline=\"central\"\n          @mousedown=${preventDefault}\n          @auxclick=${(e: MouseEvent) => {\n            if (e.button === 1) {\n              // middle mouse button\n              this.dispatchEvent(newEditWizardEvent(element));\n              e.preventDefault();\n            }\n          }}\n          @click=${handleClick}\n          @contextmenu=${(e: MouseEvent) => this.openMenu(element, e)}\n          pointer-events=\"${events}\" fill=\"${color}\" font-weight=\"${weight}\"\n          font-size=\"${fontSize}px\" font-family=\"Roboto, sans-serif\"\n          style=\"cursor: default;\">\n          ${text}\n        </text>\n      </g>`;\n  }\n\n  renderContainer(bayOrVL: Element, preview = false): TemplateResult<2> {\n    const isVL = bayOrVL.tagName === 'VoltageLevel';\n    if (this.placing === bayOrVL && !preview) return svg``;\n\n    let [x, y] = this.renderedPosition(bayOrVL);\n    const offset: Point = [this.mouseX - x, this.mouseY - y];\n    let {\n      dim: [w, h],\n    } = attributes(bayOrVL);\n    let handleClick = (e: MouseEvent) => {\n      if (this.idle)\n        this.dispatchEvent(\n          newStartPlaceEvent(\n            e.shiftKey ? copy(bayOrVL, this.nsp) : bayOrVL,\n            offset\n          )\n        );\n    };\n    let invalid = false;\n\n    if (this.resizingBR === bayOrVL) {\n      w = Math.max(1, this.mouseX - x + 1);\n      h = Math.max(1, this.mouseY - y + 1);\n      if (this.canResizeTo(bayOrVL, w, h))\n        handleClick = () =>\n          this.dispatchEvent(\n            newResizeEvent({\n              w,\n              h,\n              element: bayOrVL,\n            })\n          );\n      else invalid = true;\n    }\n\n    const right = x + w - 1;\n    const bottom = y + h - 1;\n    if (this.resizingTL === bayOrVL) {\n      w = Math.max(1, x + w - this.mouseX);\n      h = Math.max(1, y + h - this.mouseY);\n      x = Math.min(this.mouseX, right);\n      y = Math.min(this.mouseY, bottom);\n      if (this.canResizeToTL(bayOrVL, x, y, w, h))\n        handleClick = () =>\n          this.dispatchEvent(\n            newResizeTLEvent({\n              x,\n              y,\n              w,\n              h,\n              element: bayOrVL,\n            })\n          );\n      else invalid = true;\n    }\n\n    if (this.placing === bayOrVL) {\n      let parent: Element | undefined;\n      if (isVL) parent = this.substation;\n      else\n        parent = Array.from(\n          this.substation.querySelectorAll(':root > Substation > VoltageLevel')\n        ).find(vl => containsRect(vl, x, y, w, h));\n      if (parent && this.canPlaceAt(bayOrVL, x, y, w, h))\n        handleClick = () =>\n          this.dispatchEvent(\n            newPlaceEvent({\n              x,\n              y,\n              element: bayOrVL,\n              parent: parent!,\n            })\n          );\n      else invalid = true;\n    }\n\n    let placingTarget = svg``;\n    let resizingTarget = svg``;\n    if (\n      (isVL && this.placing?.tagName === 'Bay') ||\n      (!isVL && this.placing?.tagName === 'ConductingEquipment')\n    )\n      placingTarget = svg`<rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n        @click=${handleClick} fill=\"url(#grid)\" />`;\n\n    if (\n      this.resizingBR === bayOrVL ||\n      this.resizingTL === bayOrVL ||\n      (this.resizingBR?.parentElement === bayOrVL && isBusBar(this.resizingBR))\n    )\n      resizingTarget = svg`<rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n        @click=${handleClick || nothing} fill=\"url(#grid)\" />`;\n\n    const resizeBRHandle = this.idle\n      ? svg`<svg xmlns=\"${svgNs}\" height=\"1\" width=\"1\" fill=\"black\"\n          opacity=\"0.83\" class=\"handle\"\n          @click=${() => this.dispatchEvent(newStartResizeBREvent(bayOrVL))}\n          viewBox=\"0 96 960 960\" x=\"${w + x - 1}\" y=\"${h + y - 1}\">\n          <rect fill=\"white\" x=\"28.8\" y=\"124.8\" width=\"902.4\" height=\"902.4\" />\n          ${resizeBRPath}\n        </svg>`\n      : nothing;\n    const resizeTLhandle = this.idle\n      ? svg`<svg xmlns=\"${svgNs}\" height=\"1\" width=\"1\" fill=\"black\"\n          opacity=\"0.83\" class=\"handle\"\n          @click=${() => this.dispatchEvent(newStartResizeTLEvent(bayOrVL))}\n          viewBox=\"0 96 960 960\" x=\"${x}\" y=\"${y}\">\n          <rect fill=\"white\" x=\"28.8\" y=\"124.8\" width=\"902.4\" height=\"902.4\" />\n          ${resizeTLPath}\n        </svg>`\n      : nothing;\n\n    const clickthrough =\n      !this.idle &&\n      this.placing !== bayOrVL &&\n      this.resizingBR !== bayOrVL &&\n      this.resizingTL !== bayOrVL;\n\n    return svg`<g id=\"${\n      bayOrVL.closest('Substation') === this.substation\n        ? identity(bayOrVL)\n        : nothing\n    }\" class=${classMap({\n      voltagelevel: isVL,\n      bay: !isVL,\n      preview,\n    })} tabindex=\"0\" pointer-events=\"${\n      clickthrough ? 'none' : 'all'\n    }\" style=\"outline: none;\">\n      <rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n        @contextmenu=${(e: MouseEvent) => this.openMenu(bayOrVL, e)}\n        @click=${handleClick || nothing} @mousedown=${preventDefault}\n        @auxclick=${({ clientX, clientY, button }: MouseEvent) => {\n          if (button !== 1) return;\n          const mouse = this.svgCoordinates(clientX, clientY);\n          if (distance(mouse, [x, y]) < distance(mouse, [right, bottom]))\n            this.dispatchEvent(newStartResizeTLEvent(bayOrVL));\n          else this.dispatchEvent(newStartResizeBREvent(bayOrVL));\n        }}\n        fill=\"white\" stroke-dasharray=\"${isVL ? nothing : '0.18'}\"\n        stroke=\"${\n          // eslint-disable-next-line no-nested-ternary\n          invalid ? '#BB1326' : isVL ? '#F5E214' : '#12579B'\n        }\" />\n      ${Array.from(bayOrVL.children)\n        .filter(isBay)\n        .map(bay => this.renderContainer(bay))}\n      ${Array.from(bayOrVL.children)\n        .filter(child => child.tagName === 'ConductingEquipment')\n        .map(equipment => this.renderEquipment(equipment))}\n      ${Array.from(bayOrVL.children)\n        .filter(child => child.tagName === 'PowerTransformer')\n        .map(equipment => this.renderPowerTransformer(equipment))}\n      ${\n        preview\n          ? Array.from(bayOrVL.querySelectorAll('ConnectivityNode'))\n              .filter(child => child.getAttribute('name') !== 'grounded')\n              .map(cNode => this.renderConnectivityNode(cNode))\n          : nothing\n      }\n      ${\n        preview\n          ? Array.from(\n              bayOrVL.querySelectorAll(\n                'Bay, ConductingEquipment, PowerTransformer, Text'\n              )\n            )\n              .concat(bayOrVL)\n              .map(element => this.renderLabel(element))\n          : nothing\n      }\n      ${resizeTLhandle}\n      ${resizeBRHandle}\n      ${placingTarget}\n      ${resizingTarget}\n    </g>`;\n  }\n\n  windingMeasures(winding: Element): {\n    center: Point;\n    size: number;\n    terminals: Partial<Record<'T1' | 'T2' | 'N1' | 'N2', Point>>;\n    grounded: Partial<Record<'N1' | 'N2', [Point, Point]>>;\n    arc?: {\n      from: Point;\n      fromCtl: Point;\n      to: Point;\n      toCtl: Point;\n    };\n    zigZagTransform?: string;\n  } {\n    const transformer = winding.parentElement!;\n    const windings = Array.from(transformer.children).filter(\n      c => c.tagName === 'TransformerWinding'\n    );\n    const [x, y] = this.renderedPosition(transformer).map(c => c + 0.5);\n    let center = [x, y] as Point;\n    const size = 0.7;\n    const grounded: Partial<Record<'N1' | 'N2', [Point, Point]>> = {};\n    const terminals: Partial<Record<'T1' | 'T2' | 'N1' | 'N2', Point>> = {};\n    let arc:\n      | {\n          from: Point;\n          fromCtl: Point;\n          to: Point;\n          toCtl: Point;\n        }\n      | undefined;\n    let zigZagTransform: string | undefined;\n    const terminalElements = Array.from(winding.children).filter(\n      c => c.tagName === 'Terminal'\n    );\n    const terminal1 = terminalElements.find(\n      t => t.getAttribute('name') === 'T1'\n    );\n    const terminal2 = terminalElements.find(\n      t => t.getAttribute('name') !== 'T1'\n    );\n    const neutral = Array.from(winding.children).find(\n      c => c.tagName === 'NeutralPoint'\n    );\n    const windingIndex = windings.indexOf(winding);\n    const { rot, kind, flip } = attributes(transformer);\n    function shift(point: Point, coord: 0 | 1, amount: number) {\n      const shifted = point.slice() as Point;\n      if (coord === 0) shifted[rot % 2] += rot < 2 ? amount : -amount;\n      else shifted[(rot + 1) % 2] += rot > 0 && rot < 3 ? -amount : amount;\n      return shifted;\n    }\n    if (windings.length === 1) {\n      if (kind === 'earthing') {\n        zigZagTransform = '';\n        const n1 = shift(center, 1, size);\n        if (!neutral) {\n          terminals.N1 = n1;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          const n1p = shift(n1, 1, 0.2);\n          grounded.N1 = [n1p, n1];\n        }\n        if (!terminal1 && !terminal2) {\n          terminals.T1 = shift(center, 1, -size);\n        }\n      } else {\n        const sgn = flip ? -1 : 1;\n        const n1 = shift(center, 0, -size);\n        const n2 = shift(center, 0, size);\n        const t1 = shift(center, 1, (-size - 0.5) * sgn);\n        const t2 = shift(center, 1, size * sgn);\n        if (!neutral) {\n          terminals.N1 = n1;\n          terminals.N2 = n2;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          if (neutral.getAttribute('name') === 'N1') {\n            const n1p = shift(n1, 0, -0.2);\n            grounded.N1 = [n1p, n1];\n          } else {\n            const n2p = shift(n2, 0, 0.2);\n            grounded.N2 = [n2p, n2];\n          }\n        }\n        arc = {\n          from: n2,\n          fromCtl: shift(n2, 1, -sgn),\n          to: t1,\n          toCtl: shift(shift(t1, 0, 0.2), 1, 0.1 * sgn),\n        };\n        if (!terminal1) {\n          terminals.T1 = t1;\n        }\n        if (!terminal2) {\n          terminals.T2 = t2;\n        }\n      }\n    } else if (windings.length === 2) {\n      if (windingIndex === 1) {\n        center = shift(center, 1, 1);\n      }\n      if (kind === 'auto') {\n        if (windingIndex === 1) {\n          const n1 = shift(center, 0, -size);\n          const n2 = shift(center, 0, size);\n          if (!neutral) {\n            terminals.N1 = n1;\n            terminals.N2 = n2;\n          } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n            if (neutral.getAttribute('name') === 'N1') {\n              const n1p = shift(n1, 0, -0.2);\n              grounded.N1 = [n1p, n1];\n            } else {\n              const n2p = shift(n2, 0, 0.2);\n              grounded.N2 = [n2p, n2];\n            }\n          }\n          if (!terminal1 && !terminal2) {\n            terminals.T1 = shift(center, 1, size);\n          }\n        } else {\n          const sgn = flip ? -1 : 1;\n          const t1 = shift(center, 0, size * sgn);\n          const t2 = shift(center, 0, (-size - 0.5) * sgn);\n          const n1 = shift(center, 1, -size);\n          arc = {\n            from: n1,\n            fromCtl: shift(n1, 0, -sgn),\n            to: t2,\n            toCtl: shift(shift(t2, 1, -0.2), 0, 0.1 * sgn),\n          };\n          if (!terminal1) terminals.T1 = t1;\n          if (!terminal2) terminals.T2 = t2;\n          if (!neutral) {\n            terminals.N1 = n1;\n          } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n            const n1p = shift(n1, 1, -0.2);\n            grounded.N1 = [n1p, n1];\n          }\n        }\n      } else if (kind === 'earthing') {\n        if (windingIndex === 1) {\n          if (!terminal1 && !terminal2) {\n            terminals.T1 = shift(center, 1, size);\n          }\n        } else {\n          zigZagTransform = zigZag2WTransform;\n          const sgn = flip ? -1 : 1;\n          if (!terminal1 && !terminal2)\n            terminals.T1 = shift(center, 0, -size * sgn);\n          const n1 = shift(center, 0, size * sgn);\n          if (!neutral) {\n            terminals.N1 = n1;\n          } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n            const n1p = shift(n1, 0, 0.2 * sgn);\n            grounded.N1 = [n1p, n1];\n          }\n        }\n      } else if (windingIndex === 1) {\n        const n1 = shift(center, 0, -size);\n        const n2 = shift(center, 0, +size);\n\n        if (!neutral) {\n          terminals.N1 = n1;\n          terminals.N2 = n2;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          if (neutral.getAttribute('name') === 'N1') {\n            const n1p = shift(n1, 0, -0.2);\n            grounded.N1 = [n1p, n1];\n          } else {\n            const n2p = shift(n2, 0, 0.2);\n            grounded.N2 = [n2p, n2];\n          }\n        }\n        if (!terminal1 && !terminal2) {\n          terminals.T1 = shift(center, 1, +size);\n        }\n      } else {\n        const n1 = shift(center, 0, -size);\n        const n2 = shift(center, 0, +size);\n\n        if (!neutral) {\n          terminals.N1 = n1;\n          terminals.N2 = n2;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          if (neutral.getAttribute('name') === 'N1') {\n            const n1p = shift(n1, 0, -0.2);\n            grounded.N1 = [n1p, n1];\n          } else {\n            const n2p = shift(n2, 0, 0.2);\n            grounded.N2 = [n2p, n2];\n          }\n        }\n        if (!terminal1 && !terminal2) {\n          terminals.T1 = shift(center, 1, -size);\n        }\n      }\n    } else if (windings.length === 3) {\n      if (windingIndex === 0) {\n        if (!terminal1 && !terminal2) {\n          terminals.T1 = shift(center, 1, -size);\n        }\n        const n1 = shift(center, 0, -size);\n        const n2 = shift(center, 0, +size);\n        if (!neutral) {\n          terminals.N1 = n1;\n          terminals.N2 = n2;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          if (neutral.getAttribute('name') === 'N1') {\n            const n1p = shift(n1, 0, -0.2);\n            grounded.N1 = [n1p, n1];\n          } else {\n            const n2p = shift(n2, 0, 0.2);\n            grounded.N2 = [n2p, n2];\n          }\n        }\n      } else if (windingIndex === 1) {\n        center = shift(shift(center, 0, 0.5), 1, 1);\n        if (!terminal1 && !terminal2) {\n          terminals.T1 = shift(center, 0, size);\n        }\n        const n1 = shift(center, 1, size);\n        if (!neutral) {\n          terminals.N1 = n1;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          const n1p = shift(n1, 1, 0.2);\n          grounded.N1 = [n1p, n1];\n        }\n      } else if (windingIndex === 2) {\n        center = shift(shift(center, 0, -0.5), 1, 1);\n        if (!terminal1 && !terminal2) {\n          terminals.T1 = shift(center, 0, -size);\n        }\n        const n1 = shift(center, 1, size);\n        if (!neutral) {\n          terminals.N1 = n1;\n        } else if (neutral.getAttribute('cNodeName') === 'grounded') {\n          const n1p = shift(n1, 1, 0.2);\n          grounded.N1 = [n1p, n1];\n        }\n      }\n    }\n    return { center, size, terminals, grounded, arc, zigZagTransform };\n  }\n\n  renderTransformerWinding(winding: Element): TemplateResult<2> {\n    const {\n      size,\n      center: [cx, cy],\n      terminals,\n      grounded,\n      arc,\n      zigZagTransform,\n    } = this.windingMeasures(winding);\n    const ports: TemplateResult<2>[] = [];\n    Object.entries(grounded).forEach(([_, [[x1, y1], [x2, y2]]]) => {\n      ports.push(\n        svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\" stroke=\"black\" stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n      );\n    });\n    const groundable = winding.closest('Bay');\n    if (\n      !(\n        this.connecting ||\n        this.resizingBR ||\n        this.resizingTL ||\n        this.placingLabel ||\n        (this.placing && this.placing !== winding.closest('PowerTransformer'))\n      )\n    )\n      Object.entries(terminals).forEach(([name, point]) => {\n        if (!point) return;\n        const [x, y] = point;\n        const x1 = Number.isInteger(x * 2) ? x : x + 1;\n        const y1 = Number.isInteger(y * 2) ? y : y + 1;\n        const terminal = name.startsWith('T');\n        const fill = terminal ? 'BB1326' : '12579B';\n        ports.push(svg`<circle class=\"port\" cx=\"${x}\" cy=\"${y}\" r=\"0.2\" opacity=\"0.4\"\n              @contextmenu=${(e: MouseEvent) => {\n                if (terminal) return;\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if (!this.idle) return;\n                this.groundTerminal(winding, name as 'T1' | 'T2' | 'N1' | 'N2');\n              }}\n              @click=${(e: MouseEvent) => {\n                e.stopImmediatePropagation();\n                if (!this.idle) return;\n                this.dispatchEvent(\n                  newStartConnectEvent({\n                    from: winding,\n                    fromTerminal: name as 'T1' | 'T2' | 'N1' | 'N2',\n                    path: [\n                      [x, y],\n                      [x1, y1],\n                    ],\n                  })\n                );\n              }}\n              fill=\"#${fill}\"\n              stroke=\"${groundable && !terminal ? '#F5E214' : fill}\" />`);\n      });\n    let longArrow = false;\n    let arcPath = svg``;\n    const { flip, rot } = attributes(winding.parentElement!);\n    if (arc) {\n      const {\n        from: [xf, yf],\n        fromCtl: [xfc, yfc],\n        to: [xt, yt],\n        toCtl: [xtc, ytc],\n      } = arc;\n      if (!flip && yfc < yf) longArrow = true;\n      if (flip && xfc > xf) longArrow = true;\n      arcPath = svg`<path d=\"M ${xf} ${yf} C ${xfc} ${yfc}, ${xtc} ${ytc}, ${xt} ${yt}\" stroke=\"black\" stroke-width=\"0.06\" />`;\n    }\n    const tapChanger = winding.querySelector('TapChanger');\n    const ltcArrow = tapChanger\n      ? svg`<line x1=\"${cx - 0.8}\" y1=\"${cy + 0.8}\" x2=\"${cx + 0.8}\" y2=\"${\n          cy - (longArrow ? 1 : 0.8)\n        }\"\n              stroke=\"black\" stroke-width=\"0.06\" marker-end=\"url(#arrow)\" />`\n      : nothing;\n    const zigZag =\n      zigZagTransform === undefined\n        ? nothing\n        : svg`<g stroke=\"black\" stroke-linecap=\"round\"\n                transform=\"rotate(${rot * 90} ${cx} ${cy})\n                translate(${cx - 1.5} ${cy - 1.5})\n                ${zigZagTransform}\">${zigZagPath}</g>`;\n    return svg`<g class=\"winding\"\n        @contextmenu=${(e: MouseEvent) => this.openMenu(winding, e)}\n    ><circle cx=\"${cx}\" cy=\"${cy}\" r=\"${size}\" stroke=\"black\" stroke-width=\"0.06\" />${arcPath}${zigZag}${ltcArrow}${ports}</g>`;\n  }\n\n  renderPowerTransformer(\n    transformer: Element,\n    preview = false\n  ): TemplateResult<2> {\n    if (this.placing === transformer && !preview) return svg``;\n    const windings = Array.from(transformer.children).filter(\n      c => c.tagName === 'TransformerWinding'\n    );\n    const [x, y] = this.renderedPosition(transformer);\n    const offset: Point = [this.mouseX - x, this.mouseY - y];\n\n    const clickTarget =\n      this.placing === transformer\n        ? svg`<rect width=\"1\" height=\"1\" fill=\"none\"\n              x=\"${this.mouseX}\" y=\"${this.mouseY}\" />`\n        : nothing;\n\n    return svg`<g class=\"${classMap({ transformer: true, preview })}\"\n        pointer-events=\"all\"\n        @mousedown=${preventDefault}\n        @auxclick=${(e: MouseEvent) => {\n          if (e.button === 1) {\n            // middle mouse button\n            this.dispatchEvent(newRotateEvent(transformer));\n            e.preventDefault();\n          }\n        }}\n        @click=${(e: MouseEvent) => {\n          if (this.placing === transformer) {\n            const parent =\n              Array.from(\n                this.substation.querySelectorAll(':scope > VoltageLevel > Bay')\n              )\n                .concat(\n                  Array.from(\n                    this.substation.querySelectorAll(':scope > VoltageLevel')\n                  )\n                )\n                .find(vl => containsRect(vl, x, y, 1, 1)) || this.substation;\n            this.dispatchEvent(\n              newPlaceEvent({\n                element: transformer,\n                parent,\n                x,\n                y,\n              })\n            );\n          }\n\n          if (!this.idle) return;\n\n          let placing = transformer;\n          if (e.shiftKey) placing = copy(transformer, this.nsp);\n          this.dispatchEvent(newStartPlaceEvent(placing, offset));\n        }}>\n        ${windings.map(w => this.renderTransformerWinding(w))}\n        ${clickTarget}\n      </g>\n      <g class=\"preview\">${\n        preview\n          ? [\n              this.renderLabel(transformer),\n              ...Array.from(transformer.querySelectorAll('Text')).map(text =>\n                this.renderLabel(text)\n              ),\n            ]\n          : nothing\n      }</g>`;\n  }\n\n  renderEquipment(\n    equipment: Element,\n    { preview = false, connect = false } = {}\n  ) {\n    if (this.placing === equipment && !preview) return svg``;\n    if (\n      this.connecting?.from.closest('Substation') === this.substation &&\n      !connect\n    )\n      return svg``;\n\n    const [x, y] = this.renderedPosition(equipment);\n    const { flip, rot } = attributes(equipment);\n    const deg = 90 * rot;\n\n    const eqType = equipment.getAttribute('type')!;\n    const ringed = ringedEqTypes.has(eqType);\n    const symbol = isEqType(eqType) ? eqType : 'ConductingEquipment';\n    const icon = ringed\n      ? svg`<svg\n    viewBox=\"0 0 25 25\"\n    width=\"1\"\n    height=\"1\"\n  >\n    ${eqRingPath}\n  </svg>`\n      : svg`<use href=\"#${symbol}\" xlink:href=\"#${symbol}\"\n              pointer-events=\"none\" />`;\n\n    let handleClick = (e: MouseEvent) => {\n      let placing = equipment;\n      if (e.shiftKey) placing = copy(equipment, this.nsp);\n      this.dispatchEvent(newStartPlaceEvent(placing));\n    };\n\n    if (this.placing === equipment) {\n      const parent = Array.from(\n        this.substation.querySelectorAll(\n          ':root > Substation > VoltageLevel > Bay'\n        )\n      ).find(bay => !isBusBar(bay) && containsRect(bay, x, y, 1, 1));\n      if (parent && this.canPlaceAt(equipment, x, y, 1, 1))\n        handleClick = () => {\n          this.dispatchEvent(\n            newPlaceEvent({\n              x,\n              y,\n              element: equipment,\n              parent,\n            })\n          );\n        };\n    }\n\n    const terminals = Array.from(equipment.children).filter(\n      c => c.tagName === 'Terminal'\n    );\n    const topTerminal = terminals.find(t => t.getAttribute('name') === 'T1');\n    const bottomTerminal = terminals.find(t => t.getAttribute('name') !== 'T1');\n\n    const topConnector =\n      topTerminal ||\n      this.resizingBR ||\n      this.resizingTL ||\n      this.connecting ||\n      this.placingLabel ||\n      (this.placing && this.placing !== equipment)\n        ? nothing\n        : svg`<circle class=\"port\" cx=\"0.5\" cy=\"0\" r=\"0.2\" opacity=\"0.4\"\n      fill=\"#BB1326\" stroke=\"#F5E214\" pointer-events=\"${\n        this.placing ? 'none' : nothing\n      }\"\n    @click=${() =>\n      this.dispatchEvent(\n        newStartConnectEvent({\n          from: equipment,\n          fromTerminal: 'T1',\n          path: connectionStartPoints(equipment).T1,\n        })\n      )}\n    @contextmenu=${(e: MouseEvent) => {\n      e.preventDefault();\n      this.groundTerminal(equipment, 'T1');\n    }}\n      />`;\n\n    const topIndicator =\n      !this.connecting ||\n      this.connecting.from === equipment ||\n      (this.connecting &&\n        this.mouseX === x &&\n        this.mouseY === y &&\n        this.nearestOpenTerminal(equipment) === 'T1') ||\n      topTerminal\n        ? nothing\n        : svg`<polygon points=\"0.3,0 0.7,0 0.5,0.4\" \n                fill=\"#BB1326\" opacity=\"0.4\" />`;\n\n    const topGrounded =\n      topTerminal?.getAttribute('cNodeName') === 'grounded'\n        ? svg`<line x1=\"0.5\" y1=\"-0.1\" x2=\"0.5\" y2=\"0.16\" stroke=\"black\"\n                stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n        : nothing;\n\n    const bottomConnector =\n      bottomTerminal ||\n      this.resizingBR ||\n      this.resizingTL ||\n      this.connecting ||\n      this.placingLabel ||\n      (this.placing && this.placing !== equipment) ||\n      singleTerminal.has(eqType)\n        ? nothing\n        : svg`<circle class=\"port\" cx=\"0.5\" cy=\"1\" r=\"0.2\" opacity=\"0.4\"\n      fill=\"#BB1326\" stroke=\"#F5E214\" pointer-events=\"${\n        this.placing ? 'none' : nothing\n      }\"\n    @click=${() =>\n      this.dispatchEvent(\n        newStartConnectEvent({\n          from: equipment,\n          fromTerminal: 'T2',\n          path: connectionStartPoints(equipment).T2,\n        })\n      )}\n    @contextmenu=${(e: MouseEvent) => {\n      e.preventDefault();\n      this.groundTerminal(equipment, 'T2');\n    }}\n      />`;\n\n    const bottomIndicator =\n      !this.connecting ||\n      this.connecting.from === equipment ||\n      (this.connecting &&\n        this.mouseX === x &&\n        this.mouseY === y &&\n        this.nearestOpenTerminal(equipment) === 'T2') ||\n      bottomTerminal ||\n      singleTerminal.has(eqType)\n        ? nothing\n        : svg`<polygon points=\"0.3,1 0.7,1 0.5,0.6\" \n                fill=\"#BB1326\" opacity=\"0.4\" />`;\n\n    const bottomGrounded =\n      bottomTerminal?.getAttribute('cNodeName') === 'grounded'\n        ? svg`<line x1=\"0.5\" y1=\"1.1\" x2=\"0.5\" y2=\"0.84\" stroke=\"black\"\n                stroke-width=\"0.06\" marker-start=\"url(#grounded)\" />`\n        : nothing;\n\n    const clickthrough = connect || (!this.idle && this.placing !== equipment);\n\n    return svg`<g class=\"${classMap({\n      equipment: true,\n      preview: this.placing === equipment,\n    })}\"\n    id=\"${\n      equipment.closest('Substation') === this.substation\n        ? identity(equipment)\n        : nothing\n    }\"\n    transform=\"translate(${x} ${y}) rotate(${deg} 0.5 0.5)${\n      flip ? ' scale(-1,1) translate(-1 0)' : ''\n    }\">\n      <title>${equipment.getAttribute('name')}</title>\n      ${icon}\n      ${\n        ringed\n          ? svg`<use transform=\"rotate(${-deg} 0.5 0.5)\" pointer-events=\"none\"\n                  href=\"#${symbol}\" xlink:href=\"#${symbol}\" />`\n          : nothing\n      }\n      <rect width=\"1\" height=\"1\" fill=\"none\" pointer-events=\"${\n        clickthrough ? 'none' : 'all'\n      }\"\n        @mousedown=${preventDefault}\n        @click=${handleClick}\n        @auxclick=${(e: MouseEvent) => {\n          if (e.button === 1) {\n            // middle mouse button\n            this.dispatchEvent(newRotateEvent(equipment));\n            e.preventDefault();\n          }\n        }}\n        @contextmenu=${(e: MouseEvent) => this.openMenu(equipment, e)}\n      />\n      ${topConnector}\n      ${topIndicator}\n      ${topGrounded}\n      ${bottomConnector}\n      ${bottomIndicator}\n      ${bottomGrounded}\n    </g>\n    <g class=\"preview\">${\n      preview\n        ? [\n            this.renderLabel(equipment),\n            ...Array.from(equipment.querySelectorAll('Text')).map(text =>\n              this.renderLabel(text)\n            ),\n          ]\n        : nothing\n    }</g>`;\n  }\n\n  renderBusBar(busBar: Element) {\n    const [x, y] = this.renderedPosition(busBar);\n    const {\n      dim: [w, h],\n    } = attributes(busBar);\n    let placingTarget = svg``;\n    placingTarget = svg`<rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\"\n          pointer-events=\"all\" fill=\"none\" \n          @click=${() => {\n            const parent = Array.from(\n              this.substation.querySelectorAll(\n                ':root > Substation > VoltageLevel'\n              )\n            ).find(vl => containsRect(vl, x, y, w, h));\n            if (parent)\n              this.dispatchEvent(\n                newPlaceEvent({\n                  x,\n                  y,\n                  element: busBar,\n                  parent: parent!,\n                })\n              );\n          }}\n        />`;\n    return svg`<g class=\"bus preview\" id=\"${\n      busBar.closest('Substation') === this.substation\n        ? identity(busBar)\n        : nothing\n    }\">\n      <title>${busBar.getAttribute('name')}</title>\n      ${this.renderLabel(busBar)}\n      ${Array.from(busBar.querySelectorAll('Text')).map(text =>\n        this.renderLabel(text)\n      )}\n      ${this.renderConnectivityNode(busBar.querySelector('ConnectivityNode')!)}\n      ${placingTarget}\n    </g>`;\n  }\n\n  renderConnectivityNode(cNode: Element) {\n    const priv = cNode.querySelector(`Private[type=\"${privType}\"]`);\n    if (!priv) return nothing;\n    const circles = [] as TemplateResult<2>[];\n    const intersections = Object.entries(\n      Array.from(priv.querySelectorAll('Vertex')).reduce((record, vertex) => {\n        const ret = record;\n        const key = JSON.stringify(this.renderedPosition(vertex));\n        if (ret[key]) ret[key].push(vertex);\n        else ret[key] = [vertex];\n        return ret;\n      }, {} as Record<string, Element[]>)\n    )\n      .filter(\n        ([_, vertices]) =>\n          vertices.length > 2 ||\n          (vertices.length === 2 &&\n            vertices.find(v => v.hasAttributeNS(sldNs, 'uuid')))\n      )\n      .map(([_, [vertex]]) => this.renderedPosition(vertex));\n    intersections.forEach(([x, y]) =>\n      circles.push(svg`<circle fill=\"black\" cx=\"${x}\" cy=\"${y}\" r=\"0.15\" />`)\n    );\n    const lines = [] as TemplateResult<2>[];\n    const sections = Array.from(priv.getElementsByTagNameNS(sldNs, 'Section'));\n    const bay = cNode.closest('Bay');\n    const targetSize = 0.5;\n    const pointerEvents =\n      !this.placing &&\n      (!this.resizingBR || (this.resizingBR === bay && isBusBar(bay)))\n        ? 'all'\n        : 'none';\n    sections.forEach(section => {\n      const busBar = xmlBoolean(section.getAttribute('bus'));\n      const vertices = Array.from(\n        section.getElementsByTagNameNS(sldNs, 'Vertex')\n      );\n      let i = 0;\n      while (i < vertices.length - 1) {\n        const [x1, y1] = this.renderedPosition(vertices[i]);\n        let [x2, y2] = this.renderedPosition(vertices[i + 1]);\n        let handleClick: (() => void) | symbol = nothing;\n        let handleAuxClick: ((e: MouseEvent) => void) | symbol = nothing;\n        let handleContextMenu: ((e: MouseEvent) => void) | symbol = nothing;\n        if (busBar && bay) {\n          const {\n            pos: [x, y],\n          } = attributes(bay);\n          const offset: Point = [this.mouseX - x, this.mouseY - y];\n          handleClick = () =>\n            this.dispatchEvent(newStartPlaceEvent(bay, offset));\n          handleAuxClick = ({ button }: MouseEvent) => {\n            if (button === 1) this.dispatchEvent(newStartResizeBREvent(bay));\n          };\n          handleContextMenu = (e: MouseEvent) => this.openMenu(bay, e);\n        }\n        if (busBar && this.resizingBR === bay) {\n          if (section !== sections.find(s => xmlBoolean(s.getAttribute('bus'))))\n            return;\n          circles.length = 0;\n          const {\n            pos: [vX, vY],\n            dim: [vW, vH],\n          } = attributes(bay.parentElement!);\n          const maxX = vX + vW - 0.5;\n          const maxY = vY + vH - 0.5;\n          if (i === 0) {\n            const dx = Math.max(this.mouseX - x1, 0);\n            const dy = Math.max(this.mouseY - y1, 0);\n            if (dx > dy) {\n              x2 = Math.max(x1, Math.min(maxX, this.mouseX + 0.5));\n              y2 = y1;\n            } else {\n              y2 = Math.max(y1, Math.min(maxY, this.mouseY + 0.5));\n              x2 = x1;\n            }\n            if (x1 === x2 && y1 === y2)\n              if (x2 >= maxX) y2 += 1;\n              else x2 += 1;\n          }\n          handleClick = () => {\n            this.dispatchEvent(\n              newPlaceEvent({\n                parent: section,\n                element: vertices[vertices.length - 1],\n                x: x2,\n                y: y2,\n              })\n            );\n          };\n          lines.push(svg`<rect x=\"${this.mouseX}\" y=\"${this.mouseY}\"\n              width=\"1\" height=\"1\" fill=\"none\" pointer-events=\"${pointerEvents}\"\n              @click=${handleClick} />`);\n        }\n        if (this.connecting)\n          handleClick = () => {\n            const { from, path, fromTerminal } = this.connecting!;\n            if (\n              from\n                .closest('ConductingEquipment, PowerTransformer')!\n                .querySelector(\n                  `[connectivityNode=\"${cNode.getAttribute('pathName')}\"]`\n                )\n            )\n              return;\n            const [[oldX1, oldY1], [oldX2, oldY2]] = path.slice(-2);\n            const vertical = oldX1 === oldX2;\n\n            let x3 = this.mouseX2;\n            let y3 = this.mouseY2;\n\n            let newX2 = vertical ? oldX2 : x3;\n            let newY2 = vertical ? y3 : oldY2;\n\n            const start =\n              newX2 === x3 && newY2 === y3\n                ? ([oldX1, oldY1] as Point)\n                : ([newX2, newY2] as Point);\n\n            [x3, y3] = findIntersection(start, [x3, y3], [x1, y1], [x2, y2]);\n\n            newX2 = vertical ? oldX2 : x3;\n            newY2 = vertical ? y3 : oldY2;\n\n            path[path.length - 1] = [newX2, newY2];\n            path.push([x3, y3]);\n            cleanPath(path);\n            this.dispatchEvent(\n              newConnectEvent({\n                from,\n                fromTerminal,\n                path,\n                to: cNode,\n              })\n            );\n          };\n\n        lines.push(\n          svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                pointer-events=\"${pointerEvents}\"\n                stroke-width=\"${busBar ? 0.12 : nothing}\" stroke=\"black\" \n                stroke-linecap=\"${busBar ? 'round' : 'square'}\" />`\n        );\n        lines.push(\n          svg`<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                pointer-events=\"${pointerEvents}\" stroke-width=\"${targetSize}\"\n                @contextmenu=${handleContextMenu} @mousedown=${preventDefault}\n                @click=${handleClick} @auxclick=${handleAuxClick} />`\n        );\n        if (\n          busBar ||\n          (this.connecting && !vertices[i].hasAttributeNS(sldNs, 'uuid'))\n        )\n          lines.push(\n            svg`<rect x=\"${x1 - targetSize / 2}\" y=\"${y1 - targetSize / 2}\"\n                  width=\"${targetSize}\" height=\"${targetSize}\"\n                  @click=${handleClick} @auxclick=${handleAuxClick}\n                  @contextmenu=${handleContextMenu} @mousedown=${preventDefault}\n                  pointer-events=\"${pointerEvents}\" fill=\"none\" />`\n          );\n        if (\n          busBar ||\n          (this.connecting && !vertices[i + 1].hasAttributeNS(sldNs, 'uuid'))\n        )\n          lines.push(\n            svg`<rect x=\"${x2 - targetSize / 2}\" y=\"${y2 - targetSize / 2}\"\n                  width=\"${targetSize}\" height=\"${targetSize}\"\n                  @click=${handleClick} @auxclick=${handleAuxClick}\n                  @contextmenu=${handleContextMenu} @mousedown=${preventDefault}\n                  pointer-events=\"${pointerEvents}\" fill=\"none\" />`\n          );\n        i += 1;\n      }\n    });\n    const id =\n      cNode.closest('Substation') === this.substation\n        ? identity(cNode)\n        : nothing;\n    return svg`<g class=\"node\" id=\"${id}\" >\n        <title>${cNode.getAttribute('pathName')}</title>\n        ${circles}\n        ${lines}\n      </g>`;\n  }\n\n  static styles = css`\n    h2 {\n      font-family: Roboto;\n      font-weight: 300;\n      font-size: 24px;\n      margin-bottom: 4px;\n      color: rgba(0, 0, 0, 0.83);\n      --mdc-icon-button-size: 28px;\n      --mdc-icon-size: 24px;\n    }\n\n    menu {\n      position: fixed;\n      background: var(--oscd-base3, white);\n      margin: 0px;\n      padding: 0px;\n      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);\n      --mdc-list-vertical-padding: 0px;\n      overflow-y: auto;\n    }\n\n    .hidden {\n      display: none;\n    }\n    svg:not(:hover) ~ .coordinates {\n      display: none;\n    }\n    .coordinates {\n      position: fixed;\n      pointer-events: none;\n      font-size: 16px;\n      font-family: 'Roboto', sans-serif;\n      padding: 8px;\n      border-radius: 16px;\n      background: #fffd;\n      color: rgb(0, 0, 0 / 0.83);\n    }\n    .coordinates.invalid {\n      color: #bb1326;\n    }\n\n    * {\n      user-select: none;\n    }\n  `;\n}\n"]}