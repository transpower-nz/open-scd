{"version":3,"file":"TupleArbitrary.js","sources":["../../../../../../../node_modules/fast-check/lib/esm/arbitrary/_internals/TupleArbitrary.js"],"sourcesContent":["import { Stream } from '../../stream/Stream.js';\nimport { cloneIfNeeded, cloneMethod } from '../../check/symbols.js';\nimport { Arbitrary } from '../../check/arbitrary/definition/Arbitrary.js';\nimport { Value } from '../../check/arbitrary/definition/Value.js';\nimport { safeMap, safePush, safeSlice } from '../../utils/globals.js';\nimport { makeLazy } from '../../stream/LazyIterableIterator.js';\nconst safeArrayIsArray = Array.isArray;\nconst safeObjectDefineProperty = Object.defineProperty;\nfunction tupleMakeItCloneable(vs, values) {\n    return safeObjectDefineProperty(vs, cloneMethod, {\n        value: () => {\n            const cloned = [];\n            for (let idx = 0; idx !== values.length; ++idx) {\n                safePush(cloned, values[idx].value);\n            }\n            tupleMakeItCloneable(cloned, values);\n            return cloned;\n        },\n    });\n}\nfunction tupleWrapper(values) {\n    let cloneable = false;\n    const vs = [];\n    const ctxs = [];\n    for (let idx = 0; idx !== values.length; ++idx) {\n        const v = values[idx];\n        cloneable = cloneable || v.hasToBeCloned;\n        safePush(vs, v.value);\n        safePush(ctxs, v.context);\n    }\n    if (cloneable) {\n        tupleMakeItCloneable(vs, values);\n    }\n    return new Value(vs, ctxs);\n}\nexport function tupleShrink(arbs, value, context) {\n    const shrinks = [];\n    const safeContext = safeArrayIsArray(context) ? context : [];\n    for (let idx = 0; idx !== arbs.length; ++idx) {\n        safePush(shrinks, makeLazy(() => arbs[idx]\n            .shrink(value[idx], safeContext[idx])\n            .map((v) => {\n            const nextValues = safeMap(value, (v, idx) => new Value(cloneIfNeeded(v), safeContext[idx]));\n            return [...safeSlice(nextValues, 0, idx), v, ...safeSlice(nextValues, idx + 1)];\n        })\n            .map(tupleWrapper)));\n    }\n    return Stream.nil().join(...shrinks);\n}\nexport class TupleArbitrary extends Arbitrary {\n    constructor(arbs) {\n        super();\n        this.arbs = arbs;\n        for (let idx = 0; idx !== arbs.length; ++idx) {\n            const arb = arbs[idx];\n            if (arb == null || arb.generate == null)\n                throw new Error(`Invalid parameter encountered at index ${idx}: expecting an Arbitrary`);\n        }\n    }\n    generate(mrng, biasFactor) {\n        const mapped = [];\n        for (let idx = 0; idx !== this.arbs.length; ++idx) {\n            safePush(mapped, this.arbs[idx].generate(mrng, biasFactor));\n        }\n        return tupleWrapper(mapped);\n    }\n    canShrinkWithoutContext(value) {\n        if (!safeArrayIsArray(value) || value.length !== this.arbs.length) {\n            return false;\n        }\n        for (let index = 0; index !== this.arbs.length; ++index) {\n            if (!this.arbs[index].canShrinkWithoutContext(value[index])) {\n                return false;\n            }\n        }\n        return true;\n    }\n    shrink(value, context) {\n        return tupleShrink(this.arbs, value, context);\n    }\n}\n"],"names":[],"mappings":"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"}